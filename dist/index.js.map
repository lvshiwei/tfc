{"version":3,"file":"index.js","sources":["../src/lib/asserts.js","../src/constants.js","../src/JsonMockDescription.js","../src/tidyJsonMockDescriptor.js","../src/parseJsonMock.js","../src/YupSchemaDescription.js","../src/parseYupSchema.js","../src/generateYupSchema.js","../src/generateAntDesignForm.js","../src/index.js"],"sourcesContent":["export const isNull = v => v === null;\nexport const isUndefined = v => typeof v === \"undefined\";\nexport const isNullOrUndefined = v => isNull(v) || isUndefined(v);\n\nexport const isNotEmptyArray = v => Array.isArray(v) && v.length > 0;\nexport const isArrayButEmpty = v => Array.isArray(v) && v.length === 0;\n\nexport const isNotEmptyString = v => typeof v === \"string\" && v.length > 0;\nexport const isStringButEmpty = v => isNullOrUndefined(v) || v === \"\";\n\nexport const isPositiveNumber = v => typeof v === \"number\" && v > 0;\nexport const isNegativeNumber = v => typeof v === \"number\" && v < 0;\nexport const isRealNumber = v =>\n  v === 0 || isPositiveNumber(v) || isNegativeNumber(v);\n\nexport const isFunction = v => typeof v === \"function\";\n","export const YUP_TYPE_STRING = 'string';\nexport const YUP_TYPE_Number = 'number';\nexport const YUP_TYPE_BOOL = 'bool';\nexport const YUP_TYPE_DATE = 'date';\nexport const YUP_TYPE_ARRAY = 'array';\nexport const YUP_TYPE_MIXED = 'mixed';\nexport const YUP_KEYWORD_REQUIRED = 'required';\nexport const YUP_KEYWORD_LABEL = 'label';\nexport const YUP_KEYWORD_TYPE_ERROR = 'typeError';\n/**\n * YUP合法的指令集\n */\nexport const YUP_TYPE_LIST = [\n  YUP_TYPE_MIXED,\n  YUP_TYPE_STRING,\n  YUP_TYPE_Number,\n  YUP_TYPE_DATE,\n  YUP_TYPE_ARRAY,\n  YUP_TYPE_BOOL,\n];\n\nexport const YUP_TYPE_CASTORS = {\n  YUP_TYPE_MIXED: (value) => value,\n  YUP_TYPE_STRING: String,\n  YUP_TYPE_Number: Number,\n  YUP_TYPE_DATE: (value) => new Date(value),\n  YUP_TYPE_BOOL: Boolean,\n};\n","import { YUP_TYPE_LIST, YUP_TYPE_MIXED, YUP_TYPE_CASTORS } from './constants';\nimport { isNotEmptyString, isFunction } from './lib/asserts';\n\n/**\n * Json Mock 描述文档\n */\nexport class JsonMockDescription {\n  constructor() {\n    this.properties = [];\n  }\n}\n\n/**\n * Json Mock 字段属性描述\n */\nexport class JsonMockPropertyDescriptor {\n  constructor(key, value, annotations = []) {\n    this.key = key;\n    this.value = value;\n    this.type = YUP_TYPE_MIXED;\n    this.annotations = annotations;\n  }\n}\n\n/**\n * Json Mock 申明指令\n */\nexport class JsonMockPropertyAnnotation {\n  constructor(header, body) {\n    this.header = header;\n    this.body = body;\n    this.isDateTypeAnnotation = YUP_TYPE_LIST.includes(this.method);\n  }\n\n  get prefix() {\n    return this.header[0];\n  }\n  get method() {\n    return this.header.substring(1);\n  }\n\n  getParameters() {\n    if (isNotEmptyString(this.body)) {\n      const array = this.body\n        .split(',')\n        .map((s) => s.trim())\n        .filter(isNotEmptyString);\n\n      return array.map((item) => {\n        const type = detectDateType(item);\n        const castor = YUP_TYPE_CASTORS[type];\n        const value = isFunction(castor) ? castor(item) : item;\n        const raw = item;\n\n        return new JsonMockPropertyAnnotationParameter(type, raw, value);\n      });\n    }\n\n    return [];\n  }\n}\n\nexport class JsonMockPropertyAnnotationParameter {\n  constructor(type, raw, value) {\n    this.type = type;\n    this.raw = raw;\n    this.value = value || detectDateType(raw);\n  }\n\n  valueOf() {\n    return this.value;\n  }\n\n  toString() {\n    return this.raw;\n  }\n}\n\nfunction detectDateType(value) {\n  if (typeof value !== 'string') {\n    return value;\n  }\n\n  const b = /^(true|false)$/i;\n  const d = /^[0-9]?$/;\n  const f = /^[1-9]d*.d*|0.d*[1-9]d*$/;\n  const t = /^(?:(?!0000)[0-9]{4}([-/.]?)(?:(?:0?[1-9]|1[0-2])\\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\\1(?:29|30)|(?:0?[13578]|1[02])\\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\\2(?:29))$/;\n\n  if (b.test(value)) {\n    return Boolean(value);\n  }\n  if (t.test(value)) {\n    return new Date(value);\n  }\n  if (d.test(value)) {\n    return Number(value);\n  }\n  if (f.test(value)) {\n    return Number(value);\n  }\n}\n","/**\n * @overview prepare for generating YupSchema\n * @author shiwei.lv\n */\n\nimport { isNullOrUndefined, isNotEmptyString, isFunction } from './lib/asserts';\nimport { JsonMockPropertyAnnotationParameter } from './JsonMockDescription';\nimport { YUP_TYPE_CASTORS } from './constants';\n\n/**\n * 检查指令是否支持\n */\n/**\n * prepare for generating YupSchema\n * @param {JsonMockDescription} jsonMockDescription description object\n */\nexport default function (property) {\n  ensureDataType(property);\n  sortAnnotations(property);\n  preciselyAnnotationParameters(property);\n  // debugger;\n}\n\n/**\n * ensure data type annotation of property\n * @param {*} property\n */\nfunction ensureDataType(property) {\n  const dataTypeAnnotation = property.annotations.find(\n    (a) => a.isDateTypeAnnotation,\n  );\n\n  if (!isNullOrUndefined(dataTypeAnnotation)) {\n    property.type = dataTypeAnnotation.method;\n    return;\n  }\n\n  const type = detectDataType(property.value);\n  if (!isNullOrUndefined(type)) {\n    property.type = type;\n  }\n}\n\n/**\n * 排序\n */\nfunction sortAnnotations(property) {\n  property.annotations.reverse();\n\n  const index = property.annotations.findIndex((a) => a.isDateTypeAnnotation);\n  if (index > -1) {\n    const annotation = property.annotations[index];\n    property.annotations.splice(index, 1);\n    property.annotations.push(annotation);\n  }\n}\n\n/**\n * 参数精准化\n * @param {*} property\n */\nfunction preciselyAnnotationParameters(property) {\n  for (const annotation of property.annotations) {\n    if (isNotEmptyString(annotation.body)) {\n      const params = annotation.body.split(',').map((i) => i.trim());\n      const type = property.type;\n      annotation.parameters = params.map((p) => {\n        const castor = YUP_TYPE_CASTORS[type];\n        const tryCastValue = isFunction(castor) ? castor(p) : null;\n        return new JsonMockPropertyAnnotationParameter(p, tryCastValue);\n      });\n    }\n  }\n}\n\nfunction detectDataType(value) {\n  const b = /^(true|false)$/i;\n  const d = /^[0-9]?$/;\n  const f = /^[1-9]d*.d*|0.d*[1-9]d*$/;\n  const t = /^(?:(?!0000)[0-9]{4}([-/.]?)(?:(?:0?[1-9]|1[0-2])\\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\\1(?:29|30)|(?:0?[13578]|1[02])\\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\\2(?:29))$/;\n\n  if (b.test(value)) {\n    return 'bool';\n  }\n  if (t.test(value)) {\n    return 'date';\n  }\n  if (d.test(value)) {\n    return 'number';\n  }\n  if (f.test(value)) {\n    return 'number';\n  }\n  return 'mixed';\n}\n","import traverse from '@babel/traverse';\nimport { parse } from '@babel/parser';\nimport {\n  isNotEmptyArray,\n  isNullOrUndefined,\n  isNotEmptyString,\n} from './lib/asserts';\nimport {\n  JsonMockDescription,\n  JsonMockPropertyDescriptor,\n  JsonMockPropertyAnnotation,\n} from './JsonMockDescription';\n\nimport tidyProperty from './tidyJsonMockDescriptor';\n\n/**\n * parse JSON Mock script content, generate JSON Mock Description\n * @see ./JsonMockDescription.js\n * @param {String} text\n */\nexport default function (text) {\n  const ast = parse(text, { sourceType: 'module' });\n  const description = traverseJsonMockAST(ast);\n\n  return description;\n}\n\nexport function traverseJsonMockAST(ast) {\n  const description = new JsonMockDescription();\n\n  const propertyVisitor = {\n    ObjectProperty(path) {\n      const property = makeJsonMockProperty(path.node);\n      tidyProperty(property);\n      description.properties.push(property);\n    },\n  };\n\n  traverse(ast, {\n    ExportDefaultDeclaration(path) {\n      path.traverse({\n        ObjectExpression(path) {\n          path.traverse(propertyVisitor);\n        },\n      });\n    },\n  });\n\n  return description;\n}\n\n/**\n * 解析抽象语法节点\n * @param {Node} astNode ast 节点\n */\nexport function makeJsonMockProperty(astNode) {\n  const { key, value, leadingComments } = astNode;\n  const anotations = leadingComments\n    .map((comment) => makeAnnotation(key.name, comment))\n    .filter((i) => !isNullOrUndefined(i));\n\n  return new JsonMockPropertyDescriptor(key.name, value.value, anotations);\n}\n/**\n * 解析申明\n * @param {*} text\n */\nexport function makeAnnotation(key, leadingComment) {\n  if (leadingComment.value.trim() === '') {\n    return null;\n  }\n\n  const r = /\\s*(\\S*)\\s(.*)/;\n  const matches = leadingComment.value.match(r);\n\n  if (isNotEmptyArray(matches)) {\n    const [, b, c] = matches;\n    let header, body;\n    if (isNotEmptyString(b)) {\n      header = b.trim();\n      body = c.trim();\n    } else if (b === '' && c.includes('@')) {\n      header = c.trim();\n      body = null;\n    } else {\n      header = '@label';\n      body = c.trim();\n    }\n\n    return new JsonMockPropertyAnnotation(header, body);\n  } else {\n    return new JsonMockPropertyAnnotation('@label', key);\n  }\n}\n","/**\n * @overview 规则描述文档, 用于生成表单\n * @author shiwei.lv\n */\n\nimport {\n  YUP_TYPE_LIST,\n  YUP_KEYWORD_REQUIRED,\n  YUP_KEYWORD_LABEL,\n} from './constants';\nimport { isNullOrUndefined } from './lib/asserts';\n\nexport class YupSchemaDescription {\n  constructor() {\n    this.rules = [];\n  }\n}\n\nexport class YupSchemaRuleDescriptor {\n  constructor(name, attributes = []) {\n    this.name = name;\n    this.attributes = attributes;\n    this._label = null;\n    this._dataType = null;\n    this._isRequired = null;\n  }\n\n  get label() {\n    if (!isNullOrUndefined(this._label)) {\n      return this._label;\n    }\n\n    const found = this.attributes.find(\n      (attr) => attr.key === YUP_KEYWORD_LABEL,\n    );\n    if (!isNullOrUndefined(found)) {\n      this._label = found.values[0];\n      return this._label;\n    }\n  }\n\n  get dataType() {\n    if (!isNullOrUndefined(this._dataType)) {\n      return this._dataType;\n    }\n\n    const found = this.attributes.find(\n      (attr) => attr.isDataTypeAttribute === true,\n    );\n\n    if (!isNullOrUndefined(found)) {\n      this._dataType = found.key;\n      return found.key;\n    }\n  }\n\n  isRequired() {\n    if (!isNullOrUndefined(this._isRequired)) {\n      return this._isRequired;\n    }\n\n    return this.hasAttribute(YUP_KEYWORD_REQUIRED);\n  }\n\n  hasAttribute(name) {\n    return this.attributes.some(({ key }) => key === name);\n  }\n  getAttribute(key) {\n    return this.attributes.find((attr) => attr.key === key);\n  }\n}\n\nexport class YupSchemaRuleAttributeDescriptor {\n  constructor(key, values = []) {\n    this.key = key;\n    this.values = values;\n    this.isDataTypeAttribute = YUP_TYPE_LIST.includes(key);\n  }\n}\n","import { parse } from '@babel/parser';\nimport traverse from '@babel/traverse';\nimport * as t from '@babel/types';\nimport {\n  YupSchemaDescription,\n  YupSchemaRuleDescriptor,\n  YupSchemaRuleAttributeDescriptor,\n} from './YupSchemaDescription';\n\n/**\n * parse Yup Schema script content to make Yup Schema description\n * @see ./YupSchemaDescription.js\n * @param {string} text\n */\nexport default function (text) {\n  const ast = parse(text, { sourceType: 'module' });\n  const description = traverseYupSchemaAST(ast);\n\n  return description;\n}\n\nexport function traverseYupSchemaAST(ast) {\n  let meetExportDefaultObjectNode = false;\n  const desc = new YupSchemaDescription();\n\n  traverse(ast, {\n    ExportDefaultDeclaration(path) {\n      const { declaration: objectNode } = path.node;\n      if (\n        t.isCallExpression(objectNode) &&\n        t.isIdentifier(objectNode.callee) &&\n        objectNode.callee.name === 'object'\n      ) {\n        meetExportDefaultObjectNode = true;\n\n        for (const property of objectNode.arguments[0].properties) {\n          const { key, value } = property;\n          const attributes = [];\n          makeRuleDescriptor(value, attributes);\n          const rule = new YupSchemaRuleDescriptor(key.name);\n          rule.attributes = attributes;\n\n          desc.rules.push(rule);\n        }\n      }\n    },\n  });\n\n  if (meetExportDefaultObjectNode) {\n    console.log('done.');\n\n    return desc;\n  } else {\n    console.error(\n      'did not meet export default object call expression. failed!',\n    );\n  }\n}\n\nfunction makeRuleDescriptor(value, attributes) {\n  if (t.isCallExpression(value)) {\n    const { callee } = value;\n\n    attributes.push(\n      new YupSchemaRuleAttributeDescriptor(\n        t.isMemberExpression(callee) ? callee.property.name : callee.name,\n        makeValues(value.arguments),\n      ),\n    );\n\n    if (t.isMemberExpression(callee)) {\n      makeRuleDescriptor(callee.object, attributes);\n    }\n  }\n}\n\nfunction makeValues(parameters) {\n  return parameters.map((arg) => {\n    if (t.isArrayExpression(arg)) {\n      return arg.elements.map((e) => e.value);\n    } else {\n      return arg.value;\n    }\n  });\n}\n","import * as t from '@babel/types';\nimport generate from '@babel/generator';\nimport prepareGenerateYupSchema from './tidyJsonMockDescriptor';\nimport { parse } from '@babel/parser';\nimport { isNotEmptyArray, isNotEmptyString } from './lib/asserts';\nimport { JsonMockDescription } from './JsonMockDescription';\n\nconst CODE_TEMPLATE = `\n/**\n* @overview A Yup schema generated by tfc.\n*/\nimport { object, mixed, date, string, number, array } from \"yup\";\n\nexport default object();\n`;\n/**\n * generate yup schema code\n * @see ./JsonMockDescription.js\n * @param {JsonMockDescription} description json mock descripton object\n */\nexport default function (description) {\n  const ast = parse(CODE_TEMPLATE, { sourceType: 'module' });\n  const objectDeclaration = ast.program.body[1].declaration;\n\n  const properties = [];\n  for (const property of description.properties) {\n    const rules = makeRule(property);\n    properties.push(t.objectProperty(t.identifier(property.key), rules));\n  }\n\n  objectDeclaration.arguments.push(t.objectExpression(properties));\n\n  const output = generate(ast, {}, CODE_TEMPLATE);\n  const text = ensureReadableText(output.code);\n\n  return text;\n}\n\nfunction makeRule(property) {\n  if (isNotEmptyArray(property.annotations)) {\n    return buildChainExpression(property.annotations, 0);\n  }\n}\n\nfunction buildChainExpression(annotations, index) {\n  if (annotations.length === 1 || index === annotations.length - 1) {\n    const ann = annotations[index];\n\n    return t.callExpression(t.identifier(ann.method), makeRuleArguments(ann));\n  }\n\n  const ann = annotations[index];\n  return t.callExpression(\n    t.memberExpression(\n      buildChainExpression(annotations, index + 1),\n      t.identifier(ann.method),\n    ),\n    makeRuleArguments(annotations[index]),\n  );\n}\n/**\n * 构建规则参数\n */\nfunction makeRuleArguments(annotation) {\n  const params = annotation.getParameters();\n  return params.map((p) => {\n    const { type, value, raw } = p;\n    switch (type) {\n      case 'string':\n        return t.stringLiteral(value);\n      case 'number':\n        return t.numericLiteral(value);\n      case 'boolean':\n        return t.booleanLiteral(value);\n      case 'date':\n        return t.newExpression(t.identifier('Date'), [t.stringLiteral(raw)]);\n      default:\n        return t.stringLiteral(raw);\n    }\n  });\n}\n\n/**\n * 将unicode字符转化成可读的汉字\n * @param {*} unicodeText\n */\nfunction ensureReadableText(unicodeText) {\n  const r = /\\\\u([\\d\\w]{4})/gi;\n  const dest = unicodeText.replace(r, function (match, grp) {\n    return String.fromCharCode(parseInt(grp, 16));\n  });\n  return decodeURIComponent(dest);\n}\n","/**\n * @overview generate form code from schema description object\n * @see ./SchemaDescription.js\n * @author shiwei.lv\n */\n\nimport * as t from '@babel/types';\nimport generate from '@babel/generator';\nimport { parse } from '@babel/parser';\nimport { YUP_TYPE_LIST, YUP_TYPE_DATE } from './constants';\nimport { isNotEmptyString } from './lib/asserts';\n\nconst CODE_TEMPLATE = `\n/**\n * @overview A form component generated by tfc.\n * @author your.name@corp.com\n */\nimport React from \"react\";\nimport classnames from \"classnames\";\nimport schema from \"./schema\";\nimport { useModel, useValidation } from \"./hooks\";\nimport { List, InputItem, Picker, DatePicker } from \"antd-mobile\";\n\n/**\n * Say something to avoid warnning from eslint\n */\nexport default function () {\n  const [model, setModel] = useModel({ preOpeningTime: new Date() });\n  const [validate, errors] = useValidation(schema);\n\n  const handleSubmit = () =>\n    validate(model)\n      .then(() => alert(\"Amazing!!\"))\n      .catch(console.error);\n\n  const handleChangeInput = (name) => (value) => setModel(name, value);\n  const handleLeaveInput = (name) => () => validate(name, model[name]);\n  const handleChangeSelect = (name) => (value) => {\n    setModel(name, value);\n    validate(name, value);\n  };\n  const renderClassName = (name, properties) =>\n    classnames(...(properties || []), {\n      error: Array.isArray(errors) && errors.some((e) => e.path === name),\n      hasValue: !(model[name] === null || typeof model[name] === \"undefined\"),\n    });\n\n  const Required = () => <i className=\"required\">*</i>;\n\n  return <div className=\"form-wrapper\"></div>;\n}`;\nconst NEWLINE = t.jsxText('\\n');\n\nexport default function (description) {\n  const ast = parse(CODE_TEMPLATE, { sourceType: 'module', plugins: ['jsx'] });\n  const exportDefault = ast.program.body.find(t.isExportDefaultDeclaration);\n  const returnStatement = exportDefault.declaration.body.body.find(\n    t.isReturnStatement,\n  );\n  const divElement = returnStatement.argument;\n\n  divElement.children.push(NEWLINE);\n  const fields = t.jsxElement(\n    t.jsxOpeningElement(t.jsxIdentifier('List'), []),\n    t.jsxClosingElement(t.jsxIdentifier('List')),\n    [NEWLINE],\n  );\n\n  for (const rule of description.rules) {\n    fields.children.push(makeField(rule));\n    fields.children.push(NEWLINE);\n  }\n  divElement.children.push(fields);\n  divElement.children.push(NEWLINE);\n  const output = generate(ast, {}, CODE_TEMPLATE);\n\n  return output.code;\n}\n\nfunction makeField(ruleDescriptor) {\n  const dataType = ruleDescriptor.dataType;\n\n  if (!YUP_TYPE_LIST.includes(dataType)) {\n    return t.jsxEmptyExpression();\n  }\n\n  if (dataType === YUP_TYPE_DATE) {\n    return makeDatePicker(ruleDescriptor);\n  } else {\n    return makeInputItem(ruleDescriptor);\n  }\n}\n\nfunction makeRequiredElement() {\n  return t.jsxElement(\n    t.jsxOpeningElement(t.jsxIdentifier('Required'), [], true),\n    null,\n    [],\n    true,\n  );\n}\n\nfunction makeRenderClassAttribute(name) {\n  return t.jsxAttribute(\n    t.jsxIdentifier('className'),\n    t.jsxExpressionContainer(\n      t.callExpression(t.identifier('renderClassName'), [\n        t.stringLiteral(name),\n      ]),\n    ),\n  );\n}\n\nfunction makeDatePicker(ruleDescriptor) {\n  const { name } = ruleDescriptor;\n  const picker = t.jsxIdentifier('DatePicker');\n  const item = t.jsxIdentifier('List.Item');\n\n  return t.jsxElement(\n    t.jsxOpeningElement(picker, [\n      t.jsxAttribute(t.jsxIdentifier('mode'), t.stringLiteral('date')),\n      t.jsxAttribute(\n        t.jsxIdentifier('onChange'),\n        t.jsxExpressionContainer(\n          t.callExpression(t.identifier('handleSelectChange'), [\n            t.stringLiteral(name),\n          ]),\n        ),\n      ),\n    ]),\n    t.jsxClosingElement(picker),\n    [\n      NEWLINE,\n      t.jsxElement(\n        t.jsxOpeningElement(item, [\n          t.jsxAttribute(\n            t.jsxIdentifier('arrow'),\n            t.stringLiteral('horizontal'),\n          ),\n          makeRenderClassAttribute(name),\n        ]),\n        t.jsxClosingElement(item),\n        makeLabelAndRequired(ruleDescriptor),\n      ),\n      NEWLINE,\n    ],\n  );\n}\n\nfunction makeInputItem(ruleDescriptor) {\n  const { name } = ruleDescriptor;\n  const inputItem = t.jsxIdentifier('InputItem');\n  return t.jsxElement(\n    t.jsxOpeningElement(inputItem, [\n      makeRenderClassAttribute(name),\n      t.jsxAttribute(\n        t.jsxIdentifier('onChange'),\n        t.jsxExpressionContainer(\n          t.callExpression(t.identifier('handleInputChange'), [\n            t.stringLiteral(name),\n          ]),\n        ),\n      ),\n      t.jsxAttribute(\n        t.jsxIdentifier('onBlur'),\n        t.jsxExpressionContainer(\n          t.callExpression(t.identifier('handleLeaveInput'), [\n            t.stringLiteral(name),\n          ]),\n        ),\n      ),\n    ]),\n    t.jsxClosingElement(inputItem),\n    makeLabelAndRequired(ruleDescriptor),\n  );\n}\n\nfunction makeLabelAndRequired(ruleDescriptor) {\n  const { label, isRequired } = ruleDescriptor;\n\n  const children = [];\n  if (isNotEmptyString(label)) {\n    children.push(t.jsxText(label));\n  }\n  if (isRequired === true) {\n    children.push(makeRequiredElement());\n  }\n  return children;\n}\n","import fs from 'fs';\nimport path from 'path';\nimport parseJsonMock from './parseJsonMock';\nimport parseYupSchema from './parseYupSchema';\nimport generateYupSchema from './generateYupSchema';\nimport generateAntDesignForm from './generateAntDesignForm';\n\nexport function jsonMock2YupSchema(\n  filename,\n  saveFile = false,\n  saveFileName = 'schema.js',\n) {\n  return new Promise((resolve, reject) => {\n    console.info(\n      '==== parse JSON mock script file and generate Yup Schema ====',\n    );\n\n    return readFile(filename).then((content) => {\n      const description = parseJsonMock(content);\n      const code = generateYupSchema(description);\n\n      console.log('==  generate Yup schema ==');\n      console.log(code);\n\n      if (saveFile) {\n        return saveCode(code, saveFileName);\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\nexport function yupSchema2AntDesignForm(\n  filename,\n  saveFile = false,\n  saveFileName = 'form.jsx',\n) {\n  return new Promise((resolve) => {\n    console.info(\n      '==== parse Yup schema and generate Ant-Design form code ====',\n    );\n\n    return readFile(filename).then((content) => {\n      const description = parseYupSchema(content);\n      const code = generateAntDesignForm(description);\n\n      console.log('==  generate form ==');\n      console.log(code);\n\n      if (saveFile) {\n        return saveCode(code, saveFileName);\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\nfunction readFile(filename, encoding = 'utf8') {\n  return new Promise((resolve, reject) => {\n    fs.readFile(path.resolve(__dirname, filename), encoding, function (\n      err,\n      content,\n    ) {\n      if (err) {\n        console.error(err);\n        reject();\n      }\n      resolve(content);\n    });\n  });\n}\n\nfunction saveCode(code, fileName, encoding = 'utf8') {\n  return new Promise((resolve, reject) => {\n    fs.writeFile(path.resolve(__dirname, fileName), code, encoding, function (\n      err,\n    ) {\n      if (!isNullOrUndefined(err)) {\n        console.error(err);\n        reject();\n      }\n\n      console.log(filename + ' save done.');\n      resolve();\n    });\n  });\n}\n"],"names":["isNull","v","isUndefined","isNullOrUndefined","isNotEmptyArray","Array","isArray","length","isNotEmptyString","isFunction","YUP_TYPE_STRING","YUP_TYPE_Number","YUP_TYPE_BOOL","YUP_TYPE_DATE","YUP_TYPE_ARRAY","YUP_TYPE_MIXED","YUP_KEYWORD_REQUIRED","YUP_KEYWORD_LABEL","YUP_TYPE_LIST","YUP_TYPE_CASTORS","value","String","Number","Date","Boolean","JsonMockDescription","properties","JsonMockPropertyDescriptor","key","annotations","type","JsonMockPropertyAnnotation","header","body","isDateTypeAnnotation","includes","method","array","split","map","s","trim","filter","item","detectDateType","castor","raw","JsonMockPropertyAnnotationParameter","substring","b","d","f","t","test","property","ensureDataType","sortAnnotations","preciselyAnnotationParameters","dataTypeAnnotation","find","a","detectDataType","reverse","index","findIndex","annotation","splice","push","params","i","parameters","p","tryCastValue","text","ast","parse","sourceType","description","traverseJsonMockAST","propertyVisitor","ObjectProperty","path","makeJsonMockProperty","node","tidyProperty","traverse","ExportDefaultDeclaration","ObjectExpression","astNode","leadingComments","anotations","comment","makeAnnotation","name","leadingComment","r","matches","match","c","YupSchemaDescription","rules","YupSchemaRuleDescriptor","attributes","_label","_dataType","_isRequired","hasAttribute","some","attr","found","values","isDataTypeAttribute","YupSchemaRuleAttributeDescriptor","traverseYupSchemaAST","meetExportDefaultObjectNode","desc","objectNode","declaration","callee","arguments","makeRuleDescriptor","rule","console","log","error","makeValues","object","arg","elements","e","CODE_TEMPLATE","objectDeclaration","program","makeRule","output","generate","ensureReadableText","code","buildChainExpression","ann","makeRuleArguments","getParameters","unicodeText","dest","replace","grp","fromCharCode","parseInt","decodeURIComponent","NEWLINE","plugins","exportDefault","returnStatement","divElement","argument","children","fields","makeField","ruleDescriptor","dataType","makeDatePicker","makeInputItem","makeRequiredElement","makeRenderClassAttribute","picker","makeLabelAndRequired","inputItem","label","isRequired","jsonMock2YupSchema","filename","saveFile","saveFileName","Promise","resolve","reject","info","readFile","then","content","parseJsonMock","generateYupSchema","saveCode","yupSchema2AntDesignForm","parseYupSchema","generateAntDesignForm","encoding","fs","__dirname","err","fileName","writeFile"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAO,IAAMA,MAAM,GAAG,SAATA,MAAS,CAAAC,CAAC;AAAA,SAAIA,CAAC,KAAK,IAAV;AAAA,CAAhB;AACA,IAAMC,WAAW,GAAG,SAAdA,WAAc,CAAAD,CAAC;AAAA,SAAI,OAAOA,CAAP,KAAa,WAAjB;AAAA,CAArB;AACA,IAAME,mBAAiB,GAAG,SAApBA,iBAAoB,CAAAF,CAAC;AAAA,SAAID,MAAM,CAACC,CAAD,CAAN,IAAaC,WAAW,CAACD,CAAD,CAA5B;AAAA,CAA3B;AAEA,IAAMG,eAAe,GAAG,SAAlBA,eAAkB,CAAAH,CAAC;AAAA,SAAII,KAAK,CAACC,OAAN,CAAcL,CAAd,KAAoBA,CAAC,CAACM,MAAF,GAAW,CAAnC;AAAA,CAAzB;AAGA,IAAMC,gBAAgB,GAAG,SAAnBA,gBAAmB,CAAAP,CAAC;AAAA,SAAI,OAAOA,CAAP,KAAa,QAAb,IAAyBA,CAAC,CAACM,MAAF,GAAW,CAAxC;AAAA,CAA1B;AAQA,IAAME,UAAU,GAAG,SAAbA,UAAa,CAAAR,CAAC;AAAA,SAAI,OAAOA,CAAP,KAAa,UAAjB;AAAA,CAApB;;ACfA,IAAMS,eAAe,GAAG,QAAxB;AACA,IAAMC,eAAe,GAAG,QAAxB;AACA,IAAMC,aAAa,GAAG,MAAtB;AACA,IAAMC,aAAa,GAAG,MAAtB;AACA,IAAMC,cAAc,GAAG,OAAvB;AACA,IAAMC,cAAc,GAAG,OAAvB;AACA,IAAMC,oBAAoB,GAAG,UAA7B;AACA,IAAMC,iBAAiB,GAAG,OAA1B;AAEP;;;;AAGO,IAAMC,aAAa,GAAG,CAC3BH,cAD2B,EAE3BL,eAF2B,EAG3BC,eAH2B,EAI3BE,aAJ2B,EAK3BC,cAL2B,EAM3BF,aAN2B,CAAtB;AASA,IAAMO,gBAAgB,GAAG;AAC9BJ,EAAAA,cAAc,EAAE,wBAACK,KAAD;AAAA,WAAWA,KAAX;AAAA,GADc;AAE9BV,EAAAA,eAAe,EAAEW,MAFa;AAG9BV,EAAAA,eAAe,EAAEW,MAHa;AAI9BT,EAAAA,aAAa,EAAE,uBAACO,KAAD;AAAA,WAAW,IAAIG,IAAJ,CAASH,KAAT,CAAX;AAAA,GAJe;AAK9BR,EAAAA,aAAa,EAAEY;AALe,CAAzB;;AClBP;;;;IAGaC,mBAAb,GACE,+BAAc;AAAA;;AACZ,OAAKC,UAAL,GAAkB,EAAlB;AACD,CAHH;AAMA;;;;IAGaC,0BAAb,GACE,oCAAYC,GAAZ,EAAiBR,KAAjB,EAA0C;AAAA,MAAlBS,WAAkB,uEAAJ,EAAI;;AAAA;;AACxC,OAAKD,GAAL,GAAWA,GAAX;AACA,OAAKR,KAAL,GAAaA,KAAb;AACA,OAAKU,IAAL,GAAYf,cAAZ;AACA,OAAKc,WAAL,GAAmBA,WAAnB;AACD,CANH;AASA;;;;IAGaE,0BAAb;AACE,sCAAYC,MAAZ,EAAoBC,IAApB,EAA0B;AAAA;;AACxB,SAAKD,MAAL,GAAcA,MAAd;AACA,SAAKC,IAAL,GAAYA,IAAZ;AACA,SAAKC,oBAAL,GAA4BhB,aAAa,CAACiB,QAAd,CAAuB,KAAKC,MAA5B,CAA5B;AACD;;AALH;AAAA;AAAA,oCAckB;AACd,UAAI5B,gBAAgB,CAAC,KAAKyB,IAAN,CAApB,EAAiC;AAC/B,YAAMI,KAAK,GAAG,KAAKJ,IAAL,CACXK,KADW,CACL,GADK,EAEXC,GAFW,CAEP,UAACC,CAAD;AAAA,iBAAOA,CAAC,CAACC,IAAF,EAAP;AAAA,SAFO,EAGXC,MAHW,CAGJlC,gBAHI,CAAd;AAKA,eAAO6B,KAAK,CAACE,GAAN,CAAU,UAACI,IAAD,EAAU;AACzB,cAAMb,IAAI,GAAGc,cAAc,CAACD,IAAD,CAA3B;AACA,cAAME,MAAM,GAAG1B,gBAAgB,CAACW,IAAD,CAA/B;AACA,cAAMV,KAAK,GAAGX,UAAU,CAACoC,MAAD,CAAV,GAAqBA,MAAM,CAACF,IAAD,CAA3B,GAAoCA,IAAlD;AACA,cAAMG,GAAG,GAAGH,IAAZ;AAEA,iBAAO,IAAII,mCAAJ,CAAwCjB,IAAxC,EAA8CgB,GAA9C,EAAmD1B,KAAnD,CAAP;AACD,SAPM,CAAP;AAQD;;AAED,aAAO,EAAP;AACD;AAhCH;AAAA;AAAA,wBAOe;AACX,aAAO,KAAKY,MAAL,CAAY,CAAZ,CAAP;AACD;AATH;AAAA;AAAA,wBAUe;AACX,aAAO,KAAKA,MAAL,CAAYgB,SAAZ,CAAsB,CAAtB,CAAP;AACD;AAZH;;AAAA;AAAA;IAmCaD,mCAAb;AACE,+CAAYjB,IAAZ,EAAkBgB,GAAlB,EAAuB1B,KAAvB,EAA8B;AAAA;;AAC5B,SAAKU,IAAL,GAAYA,IAAZ;AACA,SAAKgB,GAAL,GAAWA,GAAX;AACA,SAAK1B,KAAL,GAAaA,KAAK,IAAIwB,cAAc,CAACE,GAAD,CAApC;AACD;;AALH;AAAA;AAAA,8BAOY;AACR,aAAO,KAAK1B,KAAZ;AACD;AATH;AAAA;AAAA,+BAWa;AACT,aAAO,KAAK0B,GAAZ;AACD;AAbH;;AAAA;AAAA;;AAgBA,SAASF,cAAT,CAAwBxB,KAAxB,EAA+B;AAC7B,MAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;AAC7B,WAAOA,KAAP;AACD;;AAED,MAAM6B,CAAC,GAAG,iBAAV;AACA,MAAMC,CAAC,GAAG,UAAV;AACA,MAAMC,CAAC,GAAG,0BAAV;AACA,MAAMC,CAAC,GAAG,iPAAV;;AAEA,MAAIH,CAAC,CAACI,IAAF,CAAOjC,KAAP,CAAJ,EAAmB;AACjB,WAAOI,OAAO,CAACJ,KAAD,CAAd;AACD;;AACD,MAAIgC,CAAC,CAACC,IAAF,CAAOjC,KAAP,CAAJ,EAAmB;AACjB,WAAO,IAAIG,IAAJ,CAASH,KAAT,CAAP;AACD;;AACD,MAAI8B,CAAC,CAACG,IAAF,CAAOjC,KAAP,CAAJ,EAAmB;AACjB,WAAOE,MAAM,CAACF,KAAD,CAAb;AACD;;AACD,MAAI+B,CAAC,CAACE,IAAF,CAAOjC,KAAP,CAAJ,EAAmB;AACjB,WAAOE,MAAM,CAACF,KAAD,CAAb;AACD;AACF;;AC3FD;;;;AAGA;;;;;AAIe,uBAAUkC,QAAV,EAAoB;AACjCC,EAAAA,cAAc,CAACD,QAAD,CAAd;AACAE,EAAAA,eAAe,CAACF,QAAD,CAAf;AACAG,EAAAA,6BAA6B,CAACH,QAAD,CAA7B,CAHiC;AAKlC;AAED;;;;;AAIA,SAASC,cAAT,CAAwBD,QAAxB,EAAkC;AAChC,MAAMI,kBAAkB,GAAGJ,QAAQ,CAACzB,WAAT,CAAqB8B,IAArB,CACzB,UAACC,CAAD;AAAA,WAAOA,CAAC,CAAC1B,oBAAT;AAAA,GADyB,CAA3B;;AAIA,MAAI,CAAC/B,mBAAiB,CAACuD,kBAAD,CAAtB,EAA4C;AAC1CJ,IAAAA,QAAQ,CAACxB,IAAT,GAAgB4B,kBAAkB,CAACtB,MAAnC;AACA;AACD;;AAED,MAAMN,IAAI,GAAG+B,cAAc,CAACP,QAAQ,CAAClC,KAAV,CAA3B;;AACA,MAAI,CAACjB,mBAAiB,CAAC2B,IAAD,CAAtB,EAA8B;AAC5BwB,IAAAA,QAAQ,CAACxB,IAAT,GAAgBA,IAAhB;AACD;AACF;AAED;;;;;AAGA,SAAS0B,eAAT,CAAyBF,QAAzB,EAAmC;AACjCA,EAAAA,QAAQ,CAACzB,WAAT,CAAqBiC,OAArB;AAEA,MAAMC,KAAK,GAAGT,QAAQ,CAACzB,WAAT,CAAqBmC,SAArB,CAA+B,UAACJ,CAAD;AAAA,WAAOA,CAAC,CAAC1B,oBAAT;AAAA,GAA/B,CAAd;;AACA,MAAI6B,KAAK,GAAG,CAAC,CAAb,EAAgB;AACd,QAAME,UAAU,GAAGX,QAAQ,CAACzB,WAAT,CAAqBkC,KAArB,CAAnB;AACAT,IAAAA,QAAQ,CAACzB,WAAT,CAAqBqC,MAArB,CAA4BH,KAA5B,EAAmC,CAAnC;AACAT,IAAAA,QAAQ,CAACzB,WAAT,CAAqBsC,IAArB,CAA0BF,UAA1B;AACD;AACF;AAED;;;;;;AAIA,SAASR,6BAAT,CAAuCH,QAAvC,EAAiD;AAAA,6CACtBA,QAAQ,CAACzB,WADa;AAAA;;AAAA;AAC/C,wDAA+C;AAAA,UAApCoC,UAAoC;;AAC7C,UAAIzD,gBAAgB,CAACyD,UAAU,CAAChC,IAAZ,CAApB,EAAuC;AAAA;AACrC,cAAMmC,MAAM,GAAGH,UAAU,CAAChC,IAAX,CAAgBK,KAAhB,CAAsB,GAAtB,EAA2BC,GAA3B,CAA+B,UAAC8B,CAAD;AAAA,mBAAOA,CAAC,CAAC5B,IAAF,EAAP;AAAA,WAA/B,CAAf;AACA,cAAMX,IAAI,GAAGwB,QAAQ,CAACxB,IAAtB;AACAmC,UAAAA,UAAU,CAACK,UAAX,GAAwBF,MAAM,CAAC7B,GAAP,CAAW,UAACgC,CAAD,EAAO;AACxC,gBAAM1B,MAAM,GAAG1B,gBAAgB,CAACW,IAAD,CAA/B;AACA,gBAAM0C,YAAY,GAAG/D,UAAU,CAACoC,MAAD,CAAV,GAAqBA,MAAM,CAAC0B,CAAD,CAA3B,GAAiC,IAAtD;AACA,mBAAO,IAAIxB,mCAAJ,CAAwCwB,CAAxC,EAA2CC,YAA3C,CAAP;AACD,WAJuB,CAAxB;AAHqC;AAQtC;AACF;AAX8C;AAAA;AAAA;AAAA;AAAA;AAYhD;;AAED,SAASX,cAAT,CAAwBzC,KAAxB,EAA+B;AAC7B,MAAM6B,CAAC,GAAG,iBAAV;AACA,MAAMC,CAAC,GAAG,UAAV;AACA,MAAMC,CAAC,GAAG,0BAAV;AACA,MAAMC,CAAC,GAAG,iPAAV;;AAEA,MAAIH,CAAC,CAACI,IAAF,CAAOjC,KAAP,CAAJ,EAAmB;AACjB,WAAO,MAAP;AACD;;AACD,MAAIgC,CAAC,CAACC,IAAF,CAAOjC,KAAP,CAAJ,EAAmB;AACjB,WAAO,MAAP;AACD;;AACD,MAAI8B,CAAC,CAACG,IAAF,CAAOjC,KAAP,CAAJ,EAAmB;AACjB,WAAO,QAAP;AACD;;AACD,MAAI+B,CAAC,CAACE,IAAF,CAAOjC,KAAP,CAAJ,EAAmB;AACjB,WAAO,QAAP;AACD;;AACD,SAAO,OAAP;AACD;;AC/ED;;;;;;AAKe,wBAAUqD,IAAV,EAAgB;AAC7B,MAAMC,GAAG,GAAGC,YAAK,CAACF,IAAD,EAAO;AAAEG,IAAAA,UAAU,EAAE;AAAd,GAAP,CAAjB;AACA,MAAMC,WAAW,GAAGC,mBAAmB,CAACJ,GAAD,CAAvC;AAEA,SAAOG,WAAP;AACD;AAEM,SAASC,mBAAT,CAA6BJ,GAA7B,EAAkC;AACvC,MAAMG,WAAW,GAAG,IAAIpD,mBAAJ,EAApB;AAEA,MAAMsD,eAAe,GAAG;AACtBC,IAAAA,cADsB,0BACPC,IADO,EACD;AACnB,UAAM3B,QAAQ,GAAG4B,oBAAoB,CAACD,IAAI,CAACE,IAAN,CAArC;AACAC,MAAAA,YAAY,CAAC9B,QAAD,CAAZ;AACAuB,MAAAA,WAAW,CAACnD,UAAZ,CAAuByC,IAAvB,CAA4Bb,QAA5B;AACD;AALqB,GAAxB;AAQA+B,EAAAA,QAAQ,CAACX,GAAD,EAAM;AACZY,IAAAA,wBADY,oCACaL,IADb,EACmB;AAC7BA,MAAAA,IAAI,CAACI,QAAL,CAAc;AACZE,QAAAA,gBADY,4BACKN,IADL,EACW;AACrBA,UAAAA,IAAI,CAACI,QAAL,CAAcN,eAAd;AACD;AAHW,OAAd;AAKD;AAPW,GAAN,CAAR;AAUA,SAAOF,WAAP;AACD;AAED;;;;;AAIO,SAASK,oBAAT,CAA8BM,OAA9B,EAAuC;AAAA,MACpC5D,GADoC,GACJ4D,OADI,CACpC5D,GADoC;AAAA,MAC/BR,KAD+B,GACJoE,OADI,CAC/BpE,KAD+B;AAAA,MACxBqE,eADwB,GACJD,OADI,CACxBC,eADwB;AAE5C,MAAMC,UAAU,GAAGD,eAAe,CAC/BlD,GADgB,CACZ,UAACoD,OAAD;AAAA,WAAaC,cAAc,CAAChE,GAAG,CAACiE,IAAL,EAAWF,OAAX,CAA3B;AAAA,GADY,EAEhBjD,MAFgB,CAET,UAAC2B,CAAD;AAAA,WAAO,CAAClE,mBAAiB,CAACkE,CAAD,CAAzB;AAAA,GAFS,CAAnB;AAIA,SAAO,IAAI1C,0BAAJ,CAA+BC,GAAG,CAACiE,IAAnC,EAAyCzE,KAAK,CAACA,KAA/C,EAAsDsE,UAAtD,CAAP;AACD;AACD;;;;;AAIO,SAASE,cAAT,CAAwBhE,GAAxB,EAA6BkE,cAA7B,EAA6C;AAClD,MAAIA,cAAc,CAAC1E,KAAf,CAAqBqB,IAArB,OAAgC,EAApC,EAAwC;AACtC,WAAO,IAAP;AACD;;AAED,MAAMsD,CAAC,GAAG,gBAAV;AACA,MAAMC,OAAO,GAAGF,cAAc,CAAC1E,KAAf,CAAqB6E,KAArB,CAA2BF,CAA3B,CAAhB;;AAEA,MAAI3F,eAAe,CAAC4F,OAAD,CAAnB,EAA8B;AAAA,kCACXA,OADW;AAAA,QACnB/C,CADmB;AAAA,QAChBiD,CADgB;;AAE5B,QAAIlE,MAAJ,EAAYC,IAAZ;;AACA,QAAIzB,gBAAgB,CAACyC,CAAD,CAApB,EAAyB;AACvBjB,MAAAA,MAAM,GAAGiB,CAAC,CAACR,IAAF,EAAT;AACAR,MAAAA,IAAI,GAAGiE,CAAC,CAACzD,IAAF,EAAP;AACD,KAHD,MAGO,IAAIQ,CAAC,KAAK,EAAN,IAAYiD,CAAC,CAAC/D,QAAF,CAAW,GAAX,CAAhB,EAAiC;AACtCH,MAAAA,MAAM,GAAGkE,CAAC,CAACzD,IAAF,EAAT;AACAR,MAAAA,IAAI,GAAG,IAAP;AACD,KAHM,MAGA;AACLD,MAAAA,MAAM,GAAG,QAAT;AACAC,MAAAA,IAAI,GAAGiE,CAAC,CAACzD,IAAF,EAAP;AACD;;AAED,WAAO,IAAIV,0BAAJ,CAA+BC,MAA/B,EAAuCC,IAAvC,CAAP;AACD,GAfD,MAeO;AACL,WAAO,IAAIF,0BAAJ,CAA+B,QAA/B,EAAyCH,GAAzC,CAAP;AACD;AACF;;ICjFYuE,oBAAb,GACE,gCAAc;AAAA;;AACZ,OAAKC,KAAL,GAAa,EAAb;AACD,CAHH;IAMaC,uBAAb;AACE,mCAAYR,IAAZ,EAAmC;AAAA,QAAjBS,UAAiB,uEAAJ,EAAI;;AAAA;;AACjC,SAAKT,IAAL,GAAYA,IAAZ;AACA,SAAKS,UAAL,GAAkBA,UAAlB;AACA,SAAKC,MAAL,GAAc,IAAd;AACA,SAAKC,SAAL,GAAiB,IAAjB;AACA,SAAKC,WAAL,GAAmB,IAAnB;AACD;;AAPH;AAAA;AAAA,iCAsCe;AACX,UAAI,CAACtG,mBAAiB,CAAC,KAAKsG,WAAN,CAAtB,EAA0C;AACxC,eAAO,KAAKA,WAAZ;AACD;;AAED,aAAO,KAAKC,YAAL,CAAkB1F,oBAAlB,CAAP;AACD;AA5CH;AAAA;AAAA,iCA8Ce6E,IA9Cf,EA8CqB;AACjB,aAAO,KAAKS,UAAL,CAAgBK,IAAhB,CAAqB;AAAA,YAAG/E,GAAH,QAAGA,GAAH;AAAA,eAAaA,GAAG,KAAKiE,IAArB;AAAA,OAArB,CAAP;AACD;AAhDH;AAAA;AAAA,iCAiDejE,GAjDf,EAiDoB;AAChB,aAAO,KAAK0E,UAAL,CAAgB3C,IAAhB,CAAqB,UAACiD,IAAD;AAAA,eAAUA,IAAI,CAAChF,GAAL,KAAaA,GAAvB;AAAA,OAArB,CAAP;AACD;AAnDH;AAAA;AAAA,wBASc;AACV,UAAI,CAACzB,mBAAiB,CAAC,KAAKoG,MAAN,CAAtB,EAAqC;AACnC,eAAO,KAAKA,MAAZ;AACD;;AAED,UAAMM,KAAK,GAAG,KAAKP,UAAL,CAAgB3C,IAAhB,CACZ,UAACiD,IAAD;AAAA,eAAUA,IAAI,CAAChF,GAAL,KAAaX,iBAAvB;AAAA,OADY,CAAd;;AAGA,UAAI,CAACd,mBAAiB,CAAC0G,KAAD,CAAtB,EAA+B;AAC7B,aAAKN,MAAL,GAAcM,KAAK,CAACC,MAAN,CAAa,CAAb,CAAd;AACA,eAAO,KAAKP,MAAZ;AACD;AACF;AArBH;AAAA;AAAA,wBAuBiB;AACb,UAAI,CAACpG,mBAAiB,CAAC,KAAKqG,SAAN,CAAtB,EAAwC;AACtC,eAAO,KAAKA,SAAZ;AACD;;AAED,UAAMK,KAAK,GAAG,KAAKP,UAAL,CAAgB3C,IAAhB,CACZ,UAACiD,IAAD;AAAA,eAAUA,IAAI,CAACG,mBAAL,KAA6B,IAAvC;AAAA,OADY,CAAd;;AAIA,UAAI,CAAC5G,mBAAiB,CAAC0G,KAAD,CAAtB,EAA+B;AAC7B,aAAKL,SAAL,GAAiBK,KAAK,CAACjF,GAAvB;AACA,eAAOiF,KAAK,CAACjF,GAAb;AACD;AACF;AApCH;;AAAA;AAAA;IAsDaoF,gCAAb,GACE,0CAAYpF,GAAZ,EAA8B;AAAA,MAAbkF,MAAa,uEAAJ,EAAI;;AAAA;;AAC5B,OAAKlF,GAAL,GAAWA,GAAX;AACA,OAAKkF,MAAL,GAAcA,MAAd;AACA,OAAKC,mBAAL,GAA2B7F,aAAa,CAACiB,QAAd,CAAuBP,GAAvB,CAA3B;AACD,CALH;;AC/DA;;;;;;AAKe,yBAAU6C,IAAV,EAAgB;AAC7B,MAAMC,GAAG,GAAGC,YAAK,CAACF,IAAD,EAAO;AAAEG,IAAAA,UAAU,EAAE;AAAd,GAAP,CAAjB;AACA,MAAMC,WAAW,GAAGoC,oBAAoB,CAACvC,GAAD,CAAxC;AAEA,SAAOG,WAAP;AACD;AAEM,SAASoC,oBAAT,CAA8BvC,GAA9B,EAAmC;AACxC,MAAIwC,2BAA2B,GAAG,KAAlC;AACA,MAAMC,IAAI,GAAG,IAAIhB,oBAAJ,EAAb;AAEAd,EAAAA,QAAQ,CAACX,GAAD,EAAM;AACZY,IAAAA,wBADY,oCACaL,IADb,EACmB;AAAA,UACRmC,UADQ,GACOnC,IAAI,CAACE,IADZ,CACrBkC,WADqB;;AAE7B,UACEjE,kBAAA,CAAmBgE,UAAnB,KACAhE,cAAA,CAAegE,UAAU,CAACE,MAA1B,CADA,IAEAF,UAAU,CAACE,MAAX,CAAkBzB,IAAlB,KAA2B,QAH7B,EAIE;AACAqB,QAAAA,2BAA2B,GAAG,IAA9B;;AADA,mDAGuBE,UAAU,CAACG,SAAX,CAAqB,CAArB,EAAwB7F,UAH/C;AAAA;;AAAA;AAGA,8DAA2D;AAAA,gBAAhD4B,QAAgD;AAAA,gBACjD1B,GADiD,GAClC0B,QADkC,CACjD1B,GADiD;AAAA,gBAC5CR,KAD4C,GAClCkC,QADkC,CAC5ClC,KAD4C;AAEzD,gBAAMkF,UAAU,GAAG,EAAnB;AACAkB,YAAAA,kBAAkB,CAACpG,KAAD,EAAQkF,UAAR,CAAlB;AACA,gBAAMmB,IAAI,GAAG,IAAIpB,uBAAJ,CAA4BzE,GAAG,CAACiE,IAAhC,CAAb;AACA4B,YAAAA,IAAI,CAACnB,UAAL,GAAkBA,UAAlB;AAEAa,YAAAA,IAAI,CAACf,KAAL,CAAWjC,IAAX,CAAgBsD,IAAhB;AACD;AAXD;AAAA;AAAA;AAAA;AAAA;AAYD;AACF;AApBW,GAAN,CAAR;;AAuBA,MAAIP,2BAAJ,EAAiC;AAC/BQ,IAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;AAEA,WAAOR,IAAP;AACD,GAJD,MAIO;AACLO,IAAAA,OAAO,CAACE,KAAR,CACE,6DADF;AAGD;AACF;;AAED,SAASJ,kBAAT,CAA4BpG,KAA5B,EAAmCkF,UAAnC,EAA+C;AAC7C,MAAIlD,kBAAA,CAAmBhC,KAAnB,CAAJ,EAA+B;AAAA,QACrBkG,MADqB,GACVlG,KADU,CACrBkG,MADqB;AAG7BhB,IAAAA,UAAU,CAACnC,IAAX,CACE,IAAI6C,gCAAJ,CACE5D,oBAAA,CAAqBkE,MAArB,IAA+BA,MAAM,CAAChE,QAAP,CAAgBuC,IAA/C,GAAsDyB,MAAM,CAACzB,IAD/D,EAEEgC,UAAU,CAACzG,KAAK,CAACmG,SAAP,CAFZ,CADF;;AAOA,QAAInE,oBAAA,CAAqBkE,MAArB,CAAJ,EAAkC;AAChCE,MAAAA,kBAAkB,CAACF,MAAM,CAACQ,MAAR,EAAgBxB,UAAhB,CAAlB;AACD;AACF;AACF;;AAED,SAASuB,UAAT,CAAoBvD,UAApB,EAAgC;AAC9B,SAAOA,UAAU,CAAC/B,GAAX,CAAe,UAACwF,GAAD,EAAS;AAC7B,QAAI3E,mBAAA,CAAoB2E,GAApB,CAAJ,EAA8B;AAC5B,aAAOA,GAAG,CAACC,QAAJ,CAAazF,GAAb,CAAiB,UAAC0F,CAAD;AAAA,eAAOA,CAAC,CAAC7G,KAAT;AAAA,OAAjB,CAAP;AACD,KAFD,MAEO;AACL,aAAO2G,GAAG,CAAC3G,KAAX;AACD;AACF,GANM,CAAP;AAOD;;AC7ED,IAAM8G,aAAa,6JAAnB;AAQA;;;;;;AAKe,4BAAUrD,WAAV,EAAuB;AACpC,MAAMH,GAAG,GAAGC,YAAK,CAACuD,aAAD,EAAgB;AAAEtD,IAAAA,UAAU,EAAE;AAAd,GAAhB,CAAjB;AACA,MAAMuD,iBAAiB,GAAGzD,GAAG,CAAC0D,OAAJ,CAAYnG,IAAZ,CAAiB,CAAjB,EAAoBoF,WAA9C;AAEA,MAAM3F,UAAU,GAAG,EAAnB;;AAJoC,6CAKbmD,WAAW,CAACnD,UALC;AAAA;;AAAA;AAKpC,wDAA+C;AAAA,UAApC4B,QAAoC;AAC7C,UAAM8C,KAAK,GAAGiC,QAAQ,CAAC/E,QAAD,CAAtB;AACA5B,MAAAA,UAAU,CAACyC,IAAX,CAAgBf,gBAAA,CAAiBA,YAAA,CAAaE,QAAQ,CAAC1B,GAAtB,CAAjB,EAA6CwE,KAA7C,CAAhB;AACD;AARmC;AAAA;AAAA;AAAA;AAAA;;AAUpC+B,EAAAA,iBAAiB,CAACZ,SAAlB,CAA4BpD,IAA5B,CAAiCf,kBAAA,CAAmB1B,UAAnB,CAAjC;AAEA,MAAM4G,MAAM,GAAGC,QAAQ,CAAC7D,GAAD,EAAM,EAAN,EAAUwD,aAAV,CAAvB;AACA,MAAMzD,IAAI,GAAG+D,kBAAkB,CAACF,MAAM,CAACG,IAAR,CAA/B;AAEA,SAAOhE,IAAP;AACD;;AAED,SAAS4D,QAAT,CAAkB/E,QAAlB,EAA4B;AAC1B,MAAIlD,eAAe,CAACkD,QAAQ,CAACzB,WAAV,CAAnB,EAA2C;AACzC,WAAO6G,oBAAoB,CAACpF,QAAQ,CAACzB,WAAV,EAAuB,CAAvB,CAA3B;AACD;AACF;;AAED,SAAS6G,oBAAT,CAA8B7G,WAA9B,EAA2CkC,KAA3C,EAAkD;AAChD,MAAIlC,WAAW,CAACtB,MAAZ,KAAuB,CAAvB,IAA4BwD,KAAK,KAAKlC,WAAW,CAACtB,MAAZ,GAAqB,CAA/D,EAAkE;AAChE,QAAMoI,IAAG,GAAG9G,WAAW,CAACkC,KAAD,CAAvB;AAEA,WAAOX,gBAAA,CAAiBA,YAAA,CAAauF,IAAG,CAACvG,MAAjB,CAAjB,EAA2CwG,iBAAiB,CAACD,IAAD,CAA5D,CAAP;AACD;;AAED,MAAMA,GAAG,GAAG9G,WAAW,CAACkC,KAAD,CAAvB;AACA,SAAOX,gBAAA,CACLA,kBAAA,CACEsF,oBAAoB,CAAC7G,WAAD,EAAckC,KAAK,GAAG,CAAtB,CADtB,EAEEX,YAAA,CAAauF,GAAG,CAACvG,MAAjB,CAFF,CADK,EAKLwG,iBAAiB,CAAC/G,WAAW,CAACkC,KAAD,CAAZ,CALZ,CAAP;AAOD;AACD;;;;;AAGA,SAAS6E,iBAAT,CAA2B3E,UAA3B,EAAuC;AACrC,MAAMG,MAAM,GAAGH,UAAU,CAAC4E,aAAX,EAAf;AACA,SAAOzE,MAAM,CAAC7B,GAAP,CAAW,UAACgC,CAAD,EAAO;AAAA,QACfzC,IADe,GACMyC,CADN,CACfzC,IADe;AAAA,QACTV,KADS,GACMmD,CADN,CACTnD,KADS;AAAA,QACF0B,GADE,GACMyB,CADN,CACFzB,GADE;;AAEvB,YAAQhB,IAAR;AACE,WAAK,QAAL;AACE,eAAOsB,eAAA,CAAgBhC,KAAhB,CAAP;;AACF,WAAK,QAAL;AACE,eAAOgC,gBAAA,CAAiBhC,KAAjB,CAAP;;AACF,WAAK,SAAL;AACE,eAAOgC,gBAAA,CAAiBhC,KAAjB,CAAP;;AACF,WAAK,MAAL;AACE,eAAOgC,eAAA,CAAgBA,YAAA,CAAa,MAAb,CAAhB,EAAsC,CAACA,eAAA,CAAgBN,GAAhB,CAAD,CAAtC,CAAP;;AACF;AACE,eAAOM,eAAA,CAAgBN,GAAhB,CAAP;AAVJ;AAYD,GAdM,CAAP;AAeD;AAED;;;;;;AAIA,SAAS0F,kBAAT,CAA4BM,WAA5B,EAAyC;AACvC,MAAM/C,CAAC,GAAG,kBAAV;AACA,MAAMgD,IAAI,GAAGD,WAAW,CAACE,OAAZ,CAAoBjD,CAApB,EAAuB,UAAUE,KAAV,EAAiBgD,GAAjB,EAAsB;AACxD,WAAO5H,MAAM,CAAC6H,YAAP,CAAoBC,QAAQ,CAACF,GAAD,EAAM,EAAN,CAA5B,CAAP;AACD,GAFY,CAAb;AAGA,SAAOG,kBAAkB,CAACL,IAAD,CAAzB;AACD;;AChFD,IAAMb,eAAa,ixCAAnB;AAuCA,IAAMmB,OAAO,GAAGjG,SAAA,CAAU,IAAV,CAAhB;AAEe,gCAAUyB,WAAV,EAAuB;AACpC,MAAMH,GAAG,GAAGC,YAAK,CAACuD,eAAD,EAAgB;AAAEtD,IAAAA,UAAU,EAAE,QAAd;AAAwB0E,IAAAA,OAAO,EAAE,CAAC,KAAD;AAAjC,GAAhB,CAAjB;AACA,MAAMC,aAAa,GAAG7E,GAAG,CAAC0D,OAAJ,CAAYnG,IAAZ,CAAiB0B,IAAjB,CAAsBP,4BAAtB,CAAtB;AACA,MAAMoG,eAAe,GAAGD,aAAa,CAAClC,WAAd,CAA0BpF,IAA1B,CAA+BA,IAA/B,CAAoC0B,IAApC,CACtBP,mBADsB,CAAxB;AAGA,MAAMqG,UAAU,GAAGD,eAAe,CAACE,QAAnC;AAEAD,EAAAA,UAAU,CAACE,QAAX,CAAoBxF,IAApB,CAAyBkF,OAAzB;AACA,MAAMO,MAAM,GAAGxG,YAAA,CACbA,mBAAA,CAAoBA,eAAA,CAAgB,MAAhB,CAApB,EAA6C,EAA7C,CADa,EAEbA,mBAAA,CAAoBA,eAAA,CAAgB,MAAhB,CAApB,CAFa,EAGb,CAACiG,OAAD,CAHa,CAAf;;AAToC,6CAejBxE,WAAW,CAACuB,KAfK;AAAA;;AAAA;AAepC,wDAAsC;AAAA,UAA3BqB,IAA2B;AACpCmC,MAAAA,MAAM,CAACD,QAAP,CAAgBxF,IAAhB,CAAqB0F,SAAS,CAACpC,IAAD,CAA9B;AACAmC,MAAAA,MAAM,CAACD,QAAP,CAAgBxF,IAAhB,CAAqBkF,OAArB;AACD;AAlBmC;AAAA;AAAA;AAAA;AAAA;;AAmBpCI,EAAAA,UAAU,CAACE,QAAX,CAAoBxF,IAApB,CAAyByF,MAAzB;AACAH,EAAAA,UAAU,CAACE,QAAX,CAAoBxF,IAApB,CAAyBkF,OAAzB;AACA,MAAMf,MAAM,GAAGC,QAAQ,CAAC7D,GAAD,EAAM,EAAN,EAAUwD,eAAV,CAAvB;AAEA,SAAOI,MAAM,CAACG,IAAd;AACD;;AAED,SAASoB,SAAT,CAAmBC,cAAnB,EAAmC;AACjC,MAAMC,QAAQ,GAAGD,cAAc,CAACC,QAAhC;;AAEA,MAAI,CAAC7I,aAAa,CAACiB,QAAd,CAAuB4H,QAAvB,CAAL,EAAuC;AACrC,WAAO3G,oBAAA,EAAP;AACD;;AAED,MAAI2G,QAAQ,KAAKlJ,aAAjB,EAAgC;AAC9B,WAAOmJ,cAAc,CAACF,cAAD,CAArB;AACD,GAFD,MAEO;AACL,WAAOG,aAAa,CAACH,cAAD,CAApB;AACD;AACF;;AAED,SAASI,mBAAT,GAA+B;AAC7B,SAAO9G,YAAA,CACLA,mBAAA,CAAoBA,eAAA,CAAgB,UAAhB,CAApB,EAAiD,EAAjD,EAAqD,IAArD,CADK,EAEL,IAFK,EAGL,EAHK,EAIL,IAJK,CAAP;AAMD;;AAED,SAAS+G,wBAAT,CAAkCtE,IAAlC,EAAwC;AACtC,SAAOzC,cAAA,CACLA,eAAA,CAAgB,WAAhB,CADK,EAELA,wBAAA,CACEA,gBAAA,CAAiBA,YAAA,CAAa,iBAAb,CAAjB,EAAkD,CAChDA,eAAA,CAAgByC,IAAhB,CADgD,CAAlD,CADF,CAFK,CAAP;AAQD;;AAED,SAASmE,cAAT,CAAwBF,cAAxB,EAAwC;AAAA,MAC9BjE,IAD8B,GACrBiE,cADqB,CAC9BjE,IAD8B;AAEtC,MAAMuE,MAAM,GAAGhH,eAAA,CAAgB,YAAhB,CAAf;AACA,MAAMT,IAAI,GAAGS,eAAA,CAAgB,WAAhB,CAAb;AAEA,SAAOA,YAAA,CACLA,mBAAA,CAAoBgH,MAApB,EAA4B,CAC1BhH,cAAA,CAAeA,eAAA,CAAgB,MAAhB,CAAf,EAAwCA,eAAA,CAAgB,MAAhB,CAAxC,CAD0B,EAE1BA,cAAA,CACEA,eAAA,CAAgB,UAAhB,CADF,EAEEA,wBAAA,CACEA,gBAAA,CAAiBA,YAAA,CAAa,oBAAb,CAAjB,EAAqD,CACnDA,eAAA,CAAgByC,IAAhB,CADmD,CAArD,CADF,CAFF,CAF0B,CAA5B,CADK,EAYLzC,mBAAA,CAAoBgH,MAApB,CAZK,EAaL,CACEf,OADF,EAEEjG,YAAA,CACEA,mBAAA,CAAoBT,IAApB,EAA0B,CACxBS,cAAA,CACEA,eAAA,CAAgB,OAAhB,CADF,EAEEA,eAAA,CAAgB,YAAhB,CAFF,CADwB,EAKxB+G,wBAAwB,CAACtE,IAAD,CALA,CAA1B,CADF,EAQEzC,mBAAA,CAAoBT,IAApB,CARF,EASE0H,oBAAoB,CAACP,cAAD,CATtB,CAFF,EAaET,OAbF,CAbK,CAAP;AA6BD;;AAED,SAASY,aAAT,CAAuBH,cAAvB,EAAuC;AAAA,MAC7BjE,IAD6B,GACpBiE,cADoB,CAC7BjE,IAD6B;AAErC,MAAMyE,SAAS,GAAGlH,eAAA,CAAgB,WAAhB,CAAlB;AACA,SAAOA,YAAA,CACLA,mBAAA,CAAoBkH,SAApB,EAA+B,CAC7BH,wBAAwB,CAACtE,IAAD,CADK,EAE7BzC,cAAA,CACEA,eAAA,CAAgB,UAAhB,CADF,EAEEA,wBAAA,CACEA,gBAAA,CAAiBA,YAAA,CAAa,mBAAb,CAAjB,EAAoD,CAClDA,eAAA,CAAgByC,IAAhB,CADkD,CAApD,CADF,CAFF,CAF6B,EAU7BzC,cAAA,CACEA,eAAA,CAAgB,QAAhB,CADF,EAEEA,wBAAA,CACEA,gBAAA,CAAiBA,YAAA,CAAa,kBAAb,CAAjB,EAAmD,CACjDA,eAAA,CAAgByC,IAAhB,CADiD,CAAnD,CADF,CAFF,CAV6B,CAA/B,CADK,EAoBLzC,mBAAA,CAAoBkH,SAApB,CApBK,EAqBLD,oBAAoB,CAACP,cAAD,CArBf,CAAP;AAuBD;;AAED,SAASO,oBAAT,CAA8BP,cAA9B,EAA8C;AAAA,MACpCS,KADoC,GACdT,cADc,CACpCS,KADoC;AAAA,MAC7BC,UAD6B,GACdV,cADc,CAC7BU,UAD6B;AAG5C,MAAMb,QAAQ,GAAG,EAAjB;;AACA,MAAInJ,gBAAgB,CAAC+J,KAAD,CAApB,EAA6B;AAC3BZ,IAAAA,QAAQ,CAACxF,IAAT,CAAcf,SAAA,CAAUmH,KAAV,CAAd;AACD;;AACD,MAAIC,UAAU,KAAK,IAAnB,EAAyB;AACvBb,IAAAA,QAAQ,CAACxF,IAAT,CAAc+F,mBAAmB,EAAjC;AACD;;AACD,SAAOP,QAAP;AACD;;ACrLM,SAASc,kBAAT,CACLC,QADK,EAIL;AAAA,MAFAC,QAEA,uEAFW,KAEX;AAAA,MADAC,YACA,uEADe,WACf;AACA,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCrD,IAAAA,OAAO,CAACsD,IAAR,CACE,+DADF;AAIA,WAAOC,QAAQ,CAACP,QAAD,CAAR,CAAmBQ,IAAnB,CAAwB,UAACC,OAAD,EAAa;AAC1C,UAAMtG,WAAW,GAAGuG,aAAa,CAACD,OAAD,CAAjC;AACA,UAAM1C,IAAI,GAAG4C,iBAAiB,CAACxG,WAAD,CAA9B;AAEA6C,MAAAA,OAAO,CAACC,GAAR,CAAY,4BAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYc,IAAZ;;AAEA,UAAIkC,QAAJ,EAAc;AACZ,eAAOW,QAAQ,CAAC7C,IAAD,EAAOmC,YAAP,CAAf;AACD,OAFD,MAEO;AACLE,QAAAA,OAAO;AACR;AACF,KAZM,CAAP;AAaD,GAlBM,CAAP;AAmBD;AAEM,SAASS,uBAAT,CACLb,QADK,EAIL;AAAA,MAFAC,QAEA,uEAFW,KAEX;AAAA,MADAC,YACA,uEADe,UACf;AACA,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAa;AAC9BpD,IAAAA,OAAO,CAACsD,IAAR,CACE,8DADF;AAIA,WAAOC,QAAQ,CAACP,QAAD,CAAR,CAAmBQ,IAAnB,CAAwB,UAACC,OAAD,EAAa;AAC1C,UAAMtG,WAAW,GAAG2G,cAAc,CAACL,OAAD,CAAlC;AACA,UAAM1C,IAAI,GAAGgD,qBAAqB,CAAC5G,WAAD,CAAlC;AAEA6C,MAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYc,IAAZ;;AAEA,UAAIkC,QAAJ,EAAc;AACZ,eAAOW,QAAQ,CAAC7C,IAAD,EAAOmC,YAAP,CAAf;AACD,OAFD,MAEO;AACLE,QAAAA,OAAO;AACR;AACF,KAZM,CAAP;AAaD,GAlBM,CAAP;AAmBD;;AAED,SAASG,QAAT,CAAkBP,QAAlB,EAA+C;AAAA,MAAnBgB,QAAmB,uEAAR,MAAQ;AAC7C,SAAO,IAAIb,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCY,IAAAA,EAAE,CAACV,QAAH,CAAYhG,IAAI,CAAC6F,OAAL,CAAac,SAAb,EAAwBlB,QAAxB,CAAZ,EAA+CgB,QAA/C,EAAyD,UACvDG,GADuD,EAEvDV,OAFuD,EAGvD;AACA,UAAIU,GAAJ,EAAS;AACPnE,QAAAA,OAAO,CAACE,KAAR,CAAciE,GAAd;AACAd,QAAAA,MAAM;AACP;;AACDD,MAAAA,OAAO,CAACK,OAAD,CAAP;AACD,KATD;AAUD,GAXM,CAAP;AAYD;;AAED,SAASG,QAAT,CAAkB7C,IAAlB,EAAwBqD,QAAxB,EAAqD;AAAA,MAAnBJ,QAAmB,uEAAR,MAAQ;AACnD,SAAO,IAAIb,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCY,IAAAA,EAAE,CAACI,SAAH,CAAa9G,IAAI,CAAC6F,OAAL,CAAac,SAAb,EAAwBE,QAAxB,CAAb,EAAgDrD,IAAhD,EAAsDiD,QAAtD,EAAgE,UAC9DG,GAD8D,EAE9D;AACA,UAAI,CAAC1L,iBAAiB,CAAC0L,GAAD,CAAtB,EAA6B;AAC3BnE,QAAAA,OAAO,CAACE,KAAR,CAAciE,GAAd;AACAd,QAAAA,MAAM;AACP;;AAEDrD,MAAAA,OAAO,CAACC,GAAR,CAAY+C,QAAQ,GAAG,aAAvB;AACAI,MAAAA,OAAO;AACR,KAVD;AAWD,GAZM,CAAP;AAaD;;;;;"}