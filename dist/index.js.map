{"version":3,"file":"index.js","sources":["../src/lib/asserts.js","../src/constants.js","../src/JsonMockDescription.js","../src/tidyJsonMockDescriptor.js","../src/parseJsonMock.js","../src/YupSchemaDescription.js","../src/parseYupSchema.js","../src/generateYupSchema.js","../src/generateAntDesignForm.js","../src/index.js"],"sourcesContent":["export const isNull = v => v === null;\nexport const isUndefined = v => typeof v === \"undefined\";\nexport const isNullOrUndefined = v => isNull(v) || isUndefined(v);\n\nexport const isNotEmptyArray = v => Array.isArray(v) && v.length > 0;\nexport const isArrayButEmpty = v => Array.isArray(v) && v.length === 0;\n\nexport const isNotEmptyString = v => typeof v === \"string\" && v.length > 0;\nexport const isStringButEmpty = v => isNullOrUndefined(v) || v === \"\";\n\nexport const isPositiveNumber = v => typeof v === \"number\" && v > 0;\nexport const isNegativeNumber = v => typeof v === \"number\" && v < 0;\nexport const isRealNumber = v =>\n  v === 0 || isPositiveNumber(v) || isNegativeNumber(v);\n\nexport const isFunction = v => typeof v === \"function\";\n","export const YUP_TYPE_STRING = 'string';\nexport const YUP_TYPE_NUMBER = 'number';\nexport const YUP_TYPE_BOOL = 'bool';\nexport const YUP_TYPE_DATE = 'date';\nexport const YUP_TYPE_ARRAY = 'array';\nexport const YUP_TYPE_MIXED = 'mixed';\nexport const YUP_KEYWORD_REQUIRED = 'required';\nexport const YUP_KEYWORD_LABEL = 'label';\nexport const YUP_KEYWORD_TYPE_ERROR = 'typeError';\n/**\n * YUP合法的指令集\n */\nexport const YUP_TYPE_LIST = [\n  YUP_TYPE_MIXED,\n  YUP_TYPE_STRING,\n  YUP_TYPE_NUMBER,\n  YUP_TYPE_DATE,\n  YUP_TYPE_ARRAY,\n  YUP_TYPE_BOOL,\n];\n\nexport const YUP_TYPE_CASTORS = {\n  [YUP_TYPE_MIXED]: (value) => value,\n  [YUP_TYPE_STRING]: (value) => String(value),\n  [YUP_TYPE_NUMBER]: (value) => Number(value),\n  [YUP_TYPE_DATE]: (value) => new Date(value),\n  [YUP_TYPE_BOOL]: (value) => {\n    if (value === 'true') return true;\n    if (value === 'false') return false;\n  },\n};\n","import {\n  YUP_TYPE_LIST,\n  YUP_TYPE_MIXED,\n  YUP_TYPE_CASTORS,\n  YUP_TYPE_STRING,\n  YUP_TYPE_BOOL,\n  YUP_TYPE_DATE,\n  YUP_TYPE_NUMBER,\n} from './constants';\nimport { isNotEmptyString, isFunction } from './lib/asserts';\n\n/**\n * Json Mock Description object\n */\nexport class JsonMockDescription {\n  constructor() {\n    this.properties = [];\n  }\n}\n\n/**\n * Json Mock description object property\n */\nexport class JsonMockPropertyDescriptor {\n  constructor(key, value, annotations = []) {\n    this.key = key;\n    this.value = value;\n    this.type = YUP_TYPE_MIXED;\n    this.annotations = annotations;\n  }\n}\n\n/**\n * Json Mock Object property annotation.\n * e.g.\n * {\n *  @string // this word means the field data type is a string.\n *  @max 20, dont make a so long text to Œname\n *  name: \"Jim Green\"\n * }\n */\nexport class JsonMockPropertyAnnotation {\n  constructor(header, body) {\n    this.header = header;\n    this.body = body;\n    this.isDateTypeAnnotation = YUP_TYPE_LIST.includes(this.method);\n  }\n\n  get prefix() {\n    return this.header[0];\n  }\n  get method() {\n    return this.header.substring(1);\n  }\n\n  getParameters() {\n    if (isNotEmptyString(this.body)) {\n      const array = this.body\n        .split(',')\n        .map((s) => s.trim())\n        .filter(isNotEmptyString);\n\n      return array.map((item) => {\n        const type = detectDateType(item);\n        const raw = item;\n        const cast = YUP_TYPE_CASTORS[type];\n        const value = isFunction(cast) ? cast(item) : item;\n\n        !isFunction(cast) && console.log('no caster', this.method, type, raw);\n\n        return new JsonMockPropertyAnnotationParameter(type, raw, value);\n      });\n    }\n\n    return [];\n  }\n}\n\nexport class JsonMockPropertyAnnotationParameter {\n  constructor(type, raw, value) {\n    this.type = type;\n    this.raw = raw;\n    this.value = value;\n  }\n\n  valueOf() {\n    return this.value;\n  }\n\n  toString() {\n    return this.raw;\n  }\n}\n\nfunction detectDateType(value) {\n  const b = /^(true|false)$/i;\n  const d = /^[0-9]?$/;\n  const f = /^[1-9]d*.d*|0.d*[1-9]d*$/;\n  const t = /^(?:(?!0000)[0-9]{4}([-/.]?)(?:(?:0?[1-9]|1[0-2])\\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\\1(?:29|30)|(?:0?[13578]|1[02])\\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\\2(?:29))$/;\n\n  if (b.test(value)) {\n    return YUP_TYPE_BOOL;\n  }\n  if (t.test(value)) {\n    return YUP_TYPE_DATE;\n  }\n  if (d.test(value)) {\n    return YUP_TYPE_NUMBER;\n  }\n  if (f.test(value)) {\n    return YUP_TYPE_NUMBER;\n  }\n\n  return YUP_TYPE_STRING;\n}\n","/**\n * @overview prepare for generating YupSchema\n * @author shiwei.lv\n */\n\nimport { isNullOrUndefined } from './lib/asserts';\nimport { JsonMockPropertyAnnotation } from './JsonMockDescription';\nimport {\n  YUP_TYPE_BOOL,\n  YUP_TYPE_DATE,\n  YUP_TYPE_NUMBER,\n  YUP_TYPE_STRING,\n} from './constants';\n\n/**\n * 检查指令是否支持\n */\n/**\n * prepare for generating YupSchema\n * @param {JsonMockDescription} jsonMockDescription description object\n */\nexport default function (property) {\n  ensureDataType(property);\n  sortAnnotations(property);\n  // debugger;\n}\n\n/**\n * ensure data type annotation of property\n * @param {*} property\n */\nfunction ensureDataType(property) {\n  const dataTypeAnnotation = property.annotations.find(\n    (a) => a.isDateTypeAnnotation,\n  );\n\n  if (!isNullOrUndefined(dataTypeAnnotation)) {\n    property.type = dataTypeAnnotation.method;\n    return;\n  }\n\n  const type = detectDataType(property.value);\n  if (!isNullOrUndefined(type)) {\n    property.type = type;\n    property.annotations.push(new JsonMockPropertyAnnotation(type, null));\n    return;\n  }\n}\n\n/**\n * 排序\n */\nfunction sortAnnotations(property) {\n  property.annotations.reverse();\n\n  const index = property.annotations.findIndex((a) => a.isDateTypeAnnotation);\n  if (index > -1) {\n    const annotation = property.annotations[index];\n    property.annotations.splice(index, 1);\n    property.annotations.push(annotation);\n  }\n}\n\nfunction detectDataType(value) {\n  const b = /^(true|false)$/i;\n  const d = /^[0-9]?$/;\n  const f = /^[1-9]d*.d*|0.d*[1-9]d*$/;\n  const t = /^(?:(?!0000)[0-9]{4}([-/.]?)(?:(?:0?[1-9]|1[0-2])\\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\\1(?:29|30)|(?:0?[13578]|1[02])\\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\\2(?:29))$/;\n\n  if (b.test(value)) {\n    return '@' + YUP_TYPE_BOOL;\n  }\n  if (t.test(value)) {\n    return '@' + YUP_TYPE_DATE;\n  }\n  if (d.test(value)) {\n    return '@' + YUP_TYPE_NUMBER;\n  }\n  if (f.test(value)) {\n    return '@' + YUP_TYPE_NUMBER;\n  }\n  return '@' + YUP_TYPE_STRING;\n}\n","import traverse from '@babel/traverse';\nimport { parse } from '@babel/parser';\nimport {\n  isNotEmptyArray,\n  isNullOrUndefined,\n  isNotEmptyString,\n} from './lib/asserts';\nimport {\n  JsonMockDescription,\n  JsonMockPropertyDescriptor,\n  JsonMockPropertyAnnotation,\n} from './JsonMockDescription';\n\nimport tidyProperty from './tidyJsonMockDescriptor';\n\n/**\n * parse JSON Mock script content, generate JSON Mock Description\n * @see ./JsonMockDescription.js\n * @param {String} text\n */\nexport default function (text) {\n  const ast = parse(text, { sourceType: 'module' });\n  const description = traverseJsonMockAST(ast);\n\n  return description;\n}\n\nexport function traverseJsonMockAST(ast) {\n  const description = new JsonMockDescription();\n\n  const propertyVisitor = {\n    ObjectProperty(path) {\n      const property = makeJsonMockProperty(path.node);\n      tidyProperty(property);\n      description.properties.push(property);\n    },\n  };\n\n  traverse(ast, {\n    ExportDefaultDeclaration(path) {\n      path.traverse({\n        ObjectExpression(path) {\n          path.traverse(propertyVisitor);\n        },\n      });\n    },\n  });\n\n  return description;\n}\n\n/**\n * 解析抽象语法节点\n * @param {Node} astNode ast 节点\n */\nexport function makeJsonMockProperty(astNode) {\n  const { key, value, leadingComments } = astNode;\n  const anotations = leadingComments\n    .map((comment) => makeAnnotation(key.name, comment))\n    .filter((i) => !isNullOrUndefined(i));\n\n  return new JsonMockPropertyDescriptor(key.name, value.value, anotations);\n}\n/**\n * 解析申明\n * @param {*} text\n */\nexport function makeAnnotation(key, leadingComment) {\n  if (leadingComment.value.trim() === '') {\n    return null;\n  }\n\n  const r = /\\s*(\\S*)\\s(.*)/;\n  const matches = leadingComment.value.match(r);\n\n  if (isNotEmptyArray(matches)) {\n    const [, b, c] = matches;\n    let header, body;\n    if (isNotEmptyString(b)) {\n      header = b.trim();\n      body = c.trim();\n    } else if (b === '' && c.includes('@')) {\n      header = c.trim();\n      body = null;\n    } else {\n      header = '@label';\n      body = c.trim();\n    }\n\n    return new JsonMockPropertyAnnotation(header, body);\n  } else {\n    return new JsonMockPropertyAnnotation('@label', key);\n  }\n}\n","/**\n * @overview 规则描述文档, 用于生成表单\n * @author shiwei.lv\n */\n\nimport {\n  YUP_TYPE_LIST,\n  YUP_KEYWORD_REQUIRED,\n  YUP_KEYWORD_LABEL,\n} from './constants';\nimport { isNullOrUndefined } from './lib/asserts';\n\nexport class YupSchemaDescription {\n  constructor() {\n    this.rules = [];\n  }\n}\n\nexport class YupSchemaRuleDescriptor {\n  constructor(name, attributes = []) {\n    this.name = name;\n    this.attributes = attributes;\n    this._label = null;\n    this._dataType = null;\n    this._isRequired = null;\n  }\n\n  get label() {\n    if (!isNullOrUndefined(this._label)) {\n      return this._label;\n    }\n\n    const found = this.attributes.find(\n      (attr) => attr.key === YUP_KEYWORD_LABEL,\n    );\n    if (!isNullOrUndefined(found)) {\n      this._label = found.values[0];\n      return this._label;\n    }\n  }\n\n  get dataType() {\n    if (!isNullOrUndefined(this._dataType)) {\n      return this._dataType;\n    }\n\n    const found = this.attributes.find(\n      (attr) => attr.isDataTypeAttribute === true,\n    );\n\n    if (!isNullOrUndefined(found)) {\n      this._dataType = found.key;\n      return found.key;\n    }\n  }\n\n  isRequired() {\n    if (!isNullOrUndefined(this._isRequired)) {\n      return this._isRequired;\n    }\n\n    return this.hasAttribute(YUP_KEYWORD_REQUIRED);\n  }\n\n  hasAttribute(name) {\n    return this.attributes.some(({ key }) => key === name);\n  }\n  getAttribute(key) {\n    return this.attributes.find((attr) => attr.key === key);\n  }\n}\n\nexport class YupSchemaRuleAttributeDescriptor {\n  constructor(key, values = []) {\n    this.key = key;\n    this.values = values;\n    this.isDataTypeAttribute = YUP_TYPE_LIST.includes(key);\n  }\n}\n","import { parse } from '@babel/parser';\nimport traverse from '@babel/traverse';\nimport * as t from '@babel/types';\nimport {\n  YupSchemaDescription,\n  YupSchemaRuleDescriptor,\n  YupSchemaRuleAttributeDescriptor,\n} from './YupSchemaDescription';\n\n/**\n * parse Yup Schema script content to make Yup Schema description\n * @see ./YupSchemaDescription.js\n * @param {string} text\n */\nexport default function (text) {\n  const ast = parse(text, { sourceType: 'module' });\n  const description = traverseYupSchemaAST(ast);\n\n  return description;\n}\n\nexport function traverseYupSchemaAST(ast) {\n  let meetExportDefaultObjectNode = false;\n  const desc = new YupSchemaDescription();\n\n  traverse(ast, {\n    ExportDefaultDeclaration(path) {\n      const { declaration: objectNode } = path.node;\n      if (\n        t.isCallExpression(objectNode) &&\n        t.isIdentifier(objectNode.callee) &&\n        objectNode.callee.name === 'object'\n      ) {\n        meetExportDefaultObjectNode = true;\n\n        for (const property of objectNode.arguments[0].properties) {\n          const { key, value } = property;\n          const attributes = [];\n          makeRuleDescriptor(value, attributes);\n          const rule = new YupSchemaRuleDescriptor(key.name);\n          rule.attributes = attributes;\n\n          desc.rules.push(rule);\n        }\n      }\n    },\n  });\n\n  if (meetExportDefaultObjectNode) {\n    console.log('done.');\n\n    return desc;\n  } else {\n    console.error(\n      'did not meet export default object call expression. failed!',\n    );\n  }\n}\n\nfunction makeRuleDescriptor(value, attributes) {\n  if (t.isCallExpression(value)) {\n    const { callee } = value;\n\n    attributes.push(\n      new YupSchemaRuleAttributeDescriptor(\n        t.isMemberExpression(callee) ? callee.property.name : callee.name,\n        makeValues(value.arguments),\n      ),\n    );\n\n    if (t.isMemberExpression(callee)) {\n      makeRuleDescriptor(callee.object, attributes);\n    }\n  }\n}\n\nfunction makeValues(parameters) {\n  return parameters.map((arg) => {\n    if (t.isArrayExpression(arg)) {\n      return arg.elements.map((e) => e.value);\n    } else {\n      return arg.value;\n    }\n  });\n}\n","import * as t from '@babel/types';\nimport generate from '@babel/generator';\nimport { parse } from '@babel/parser';\nimport { isNotEmptyArray } from './lib/asserts';\nimport { JsonMockDescription } from './JsonMockDescription';\nimport {\n  YUP_TYPE_STRING,\n  YUP_TYPE_NUMBER,\n  YUP_TYPE_BOOL,\n  YUP_TYPE_DATE,\n} from './constants';\n\nconst CODE_TEMPLATE = `\n/**\n* @overview A Yup schema generated by tfc.\n*/\nimport { object, mixed, date, string, number, array } from \"yup\";\n\nexport default object();\n`;\n/**\n * generate yup schema code\n * @see ./JsonMockDescription.js\n * @param {JsonMockDescription} description json mock descripton object\n */\nexport default function (description) {\n  const ast = parse(CODE_TEMPLATE, { sourceType: 'module' });\n  const objectDeclaration = ast.program.body[1].declaration;\n\n  const properties = [];\n  for (const property of description.properties) {\n    const rules = makeRule(property);\n    properties.push(t.objectProperty(t.identifier(property.key), rules));\n  }\n\n  objectDeclaration.arguments.push(t.objectExpression(properties));\n\n  const output = generate(ast, {}, CODE_TEMPLATE);\n  const text = ensureReadableText(output.code);\n\n  return text;\n}\n\nfunction makeRule(property) {\n  if (isNotEmptyArray(property.annotations)) {\n    return buildChainExpression(property.annotations, 0);\n  }\n}\n\nfunction buildChainExpression(annotations, index) {\n  if (annotations.length === 1 || index === annotations.length - 1) {\n    const ann = annotations[index];\n\n    return t.callExpression(t.identifier(ann.method), makeRuleArguments(ann));\n  }\n\n  const ann = annotations[index];\n  return t.callExpression(\n    t.memberExpression(\n      buildChainExpression(annotations, index + 1),\n      t.identifier(ann.method),\n    ),\n    makeRuleArguments(annotations[index]),\n  );\n}\n/**\n * 构建规则参数\n */\nfunction makeRuleArguments(annotation) {\n  const params = annotation.getParameters();\n  return params.map((p) => {\n    const { type, value, raw } = p;\n    switch (type) {\n      case YUP_TYPE_STRING:\n        return t.stringLiteral(value);\n      case YUP_TYPE_NUMBER:\n        return t.numericLiteral(value);\n      case YUP_TYPE_BOOL:\n        return t.booleanLiteral(value);\n      case YUP_TYPE_DATE:\n        return t.newExpression(t.identifier('Date'), [t.stringLiteral(raw)]);\n      default:\n        return t.stringLiteral(raw);\n    }\n  });\n}\n\n/**\n * 将unicode字符转化成可读的汉字\n * @param {*} unicodeText\n */\nfunction ensureReadableText(unicodeText) {\n  const r = /\\\\u([\\d\\w]{4})/gi;\n  const dest = unicodeText.replace(r, function (match, grp) {\n    return String.fromCharCode(parseInt(grp, 16));\n  });\n  return decodeURIComponent(dest);\n}\n","/**\n * @overview generate form code from schema description object\n * @see ./SchemaDescription.js\n * @author shiwei.lv\n */\n\nimport * as t from '@babel/types';\nimport generate from '@babel/generator';\nimport { parse } from '@babel/parser';\nimport { YUP_TYPE_LIST, YUP_TYPE_DATE } from './constants';\nimport { isNotEmptyString } from './lib/asserts';\n\nconst CODE_TEMPLATE = `\n/**\n * @overview A form component generated by tfc.\n * @author your.name@corp.com\n */\nimport React from \"react\";\nimport classnames from \"classnames\";\nimport schema from \"./schema\";\nimport { useModel, useValidation } from \"./hooks\";\nimport { List, InputItem, Picker, DatePicker } from \"antd-mobile\";\n\n/**\n * Say something to avoid warnning from eslint\n */\nexport default function () {\n  const [model, setModel] = useModel({ preOpeningTime: new Date() });\n  const [validate, errors] = useValidation(schema);\n\n  const handleSubmit = () =>\n    validate(model)\n      .then(() => alert(\"Amazing!!\"))\n      .catch(console.error);\n\n  const handleChangeInput = (name) => (value) => setModel(name, value);\n  const handleLeaveInput = (name) => () => validate(name, model[name]);\n  const handleChangeSelect = (name) => (value) => {\n    setModel(name, value);\n    validate(name, value);\n  };\n  const renderClassName = (name, properties) =>\n    classnames(...(properties || []), {\n      error: Array.isArray(errors) && errors.some((e) => e.path === name),\n      hasValue: !(model[name] === null || typeof model[name] === \"undefined\"),\n    });\n\n  const Required = () => <i className=\"required\">*</i>;\n\n  return <div className=\"form-wrapper\"></div>;\n}`;\nconst NEWLINE = t.jsxText('\\n');\n\nexport default function (description) {\n  const ast = parse(CODE_TEMPLATE, { sourceType: 'module', plugins: ['jsx'] });\n  const exportDefault = ast.program.body.find(t.isExportDefaultDeclaration);\n  const returnStatement = exportDefault.declaration.body.body.find(\n    t.isReturnStatement,\n  );\n  const divElement = returnStatement.argument;\n\n  divElement.children.push(NEWLINE);\n  const fields = t.jsxElement(\n    t.jsxOpeningElement(t.jsxIdentifier('List'), []),\n    t.jsxClosingElement(t.jsxIdentifier('List')),\n    [NEWLINE],\n  );\n\n  for (const rule of description.rules) {\n    fields.children.push(makeField(rule));\n    fields.children.push(NEWLINE);\n  }\n  divElement.children.push(fields);\n  divElement.children.push(NEWLINE);\n  const output = generate(ast, {}, CODE_TEMPLATE);\n\n  return output.code;\n}\n\nfunction makeField(ruleDescriptor) {\n  const dataType = ruleDescriptor.dataType;\n\n  if (!YUP_TYPE_LIST.includes(dataType)) {\n    return t.jsxEmptyExpression();\n  }\n\n  if (dataType === YUP_TYPE_DATE) {\n    return makeDatePicker(ruleDescriptor);\n  } else {\n    return makeInputItem(ruleDescriptor);\n  }\n}\n\nfunction makeRequiredElement() {\n  return t.jsxElement(\n    t.jsxOpeningElement(t.jsxIdentifier('Required'), [], true),\n    null,\n    [],\n    true,\n  );\n}\n\nfunction makeRenderClassAttribute(name) {\n  return t.jsxAttribute(\n    t.jsxIdentifier('className'),\n    t.jsxExpressionContainer(\n      t.callExpression(t.identifier('renderClassName'), [\n        t.stringLiteral(name),\n      ]),\n    ),\n  );\n}\n\nfunction makeDatePicker(ruleDescriptor) {\n  const { name } = ruleDescriptor;\n  const picker = t.jsxIdentifier('DatePicker');\n  const item = t.jsxIdentifier('List.Item');\n\n  return t.jsxElement(\n    t.jsxOpeningElement(picker, [\n      t.jsxAttribute(t.jsxIdentifier('mode'), t.stringLiteral('date')),\n      t.jsxAttribute(\n        t.jsxIdentifier('onChange'),\n        t.jsxExpressionContainer(\n          t.callExpression(t.identifier('handleSelectChange'), [\n            t.stringLiteral(name),\n          ]),\n        ),\n      ),\n    ]),\n    t.jsxClosingElement(picker),\n    [\n      NEWLINE,\n      t.jsxElement(\n        t.jsxOpeningElement(item, [\n          t.jsxAttribute(\n            t.jsxIdentifier('arrow'),\n            t.stringLiteral('horizontal'),\n          ),\n          makeRenderClassAttribute(name),\n        ]),\n        t.jsxClosingElement(item),\n        makeLabelAndRequired(ruleDescriptor),\n      ),\n      NEWLINE,\n    ],\n  );\n}\n\nfunction makeInputItem(ruleDescriptor) {\n  const { name } = ruleDescriptor;\n  const inputItem = t.jsxIdentifier('InputItem');\n  return t.jsxElement(\n    t.jsxOpeningElement(inputItem, [\n      makeRenderClassAttribute(name),\n      t.jsxAttribute(\n        t.jsxIdentifier('onChange'),\n        t.jsxExpressionContainer(\n          t.callExpression(t.identifier('handleInputChange'), [\n            t.stringLiteral(name),\n          ]),\n        ),\n      ),\n      t.jsxAttribute(\n        t.jsxIdentifier('onBlur'),\n        t.jsxExpressionContainer(\n          t.callExpression(t.identifier('handleLeaveInput'), [\n            t.stringLiteral(name),\n          ]),\n        ),\n      ),\n    ]),\n    t.jsxClosingElement(inputItem),\n    makeLabelAndRequired(ruleDescriptor),\n  );\n}\n\nfunction makeLabelAndRequired(ruleDescriptor) {\n  const { label, isRequired } = ruleDescriptor;\n\n  const children = [];\n  if (isNotEmptyString(label)) {\n    children.push(t.jsxText(label));\n  }\n  if (isRequired === true) {\n    children.push(makeRequiredElement());\n  }\n  return children;\n}\n","import fs from 'fs';\nimport path from 'path';\nimport parseJsonMock from './parseJsonMock';\nimport parseYupSchema from './parseYupSchema';\nimport generateYupSchema from './generateYupSchema';\nimport generateAntDesignForm from './generateAntDesignForm';\n\nexport function jsonMock2YupSchema(\n  filename,\n  saveFile = false,\n  saveFileName = 'schema.js',\n) {\n  return new Promise((resolve, reject) => {\n    console.info(\n      '==== parse JSON mock script file and generate Yup Schema ====',\n    );\n\n    return readFile(filename).then((content) => {\n      const description = parseJsonMock(content);\n      const code = generateYupSchema(description);\n\n      console.log('==  generate Yup schema ==');\n      console.log(code);\n\n      if (saveFile) {\n        return saveCode(code, saveFileName);\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\nexport function yupSchema2AntDesignForm(\n  filename,\n  saveFile = false,\n  saveFileName = 'form.jsx',\n) {\n  return new Promise((resolve) => {\n    console.info(\n      '==== parse Yup schema and generate Ant-Design form code ====',\n    );\n\n    return readFile(filename).then((content) => {\n      const description = parseYupSchema(content);\n      const code = generateAntDesignForm(description);\n\n      console.log('==  generate form ==');\n      console.log(code);\n\n      if (saveFile) {\n        return saveCode(code, saveFileName);\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\nfunction readFile(filename, encoding = 'utf8') {\n  return new Promise((resolve, reject) => {\n    fs.readFile(path.resolve(__dirname, filename), encoding, function (\n      err,\n      content,\n    ) {\n      if (err) {\n        console.error(err);\n        reject();\n      }\n      resolve(content);\n    });\n  });\n}\n\nfunction saveCode(code, fileName, encoding = 'utf8') {\n  return new Promise((resolve, reject) => {\n    fs.writeFile(path.resolve(__dirname, fileName), code, encoding, function (\n      err,\n    ) {\n      if (!isNullOrUndefined(err)) {\n        console.error(err);\n        reject();\n      }\n\n      console.log(filename + ' save done.');\n      resolve();\n    });\n  });\n}\n"],"names":["isNull","v","isUndefined","isNullOrUndefined","isNotEmptyArray","Array","isArray","length","isNotEmptyString","isFunction","YUP_TYPE_STRING","YUP_TYPE_NUMBER","YUP_TYPE_BOOL","YUP_TYPE_DATE","YUP_TYPE_ARRAY","YUP_TYPE_MIXED","YUP_KEYWORD_REQUIRED","YUP_KEYWORD_LABEL","YUP_TYPE_LIST","YUP_TYPE_CASTORS","value","String","Number","Date","JsonMockDescription","properties","JsonMockPropertyDescriptor","key","annotations","type","JsonMockPropertyAnnotation","header","body","isDateTypeAnnotation","includes","method","array","split","map","s","trim","filter","item","detectDateType","raw","cast","console","log","JsonMockPropertyAnnotationParameter","substring","b","d","f","t","test","property","ensureDataType","sortAnnotations","dataTypeAnnotation","find","a","detectDataType","push","reverse","index","findIndex","annotation","splice","text","ast","parse","sourceType","description","traverseJsonMockAST","propertyVisitor","ObjectProperty","path","makeJsonMockProperty","node","tidyProperty","traverse","ExportDefaultDeclaration","ObjectExpression","astNode","leadingComments","anotations","comment","makeAnnotation","name","i","leadingComment","r","matches","match","c","YupSchemaDescription","rules","YupSchemaRuleDescriptor","attributes","_label","_dataType","_isRequired","hasAttribute","some","attr","found","values","isDataTypeAttribute","YupSchemaRuleAttributeDescriptor","traverseYupSchemaAST","meetExportDefaultObjectNode","desc","objectNode","declaration","callee","arguments","makeRuleDescriptor","rule","error","makeValues","object","parameters","arg","elements","e","CODE_TEMPLATE","objectDeclaration","program","makeRule","output","generate","ensureReadableText","code","buildChainExpression","ann","makeRuleArguments","params","getParameters","p","unicodeText","dest","replace","grp","fromCharCode","parseInt","decodeURIComponent","NEWLINE","plugins","exportDefault","returnStatement","divElement","argument","children","fields","makeField","ruleDescriptor","dataType","makeDatePicker","makeInputItem","makeRequiredElement","makeRenderClassAttribute","picker","makeLabelAndRequired","inputItem","label","isRequired","jsonMock2YupSchema","filename","saveFile","saveFileName","Promise","resolve","reject","info","readFile","then","content","parseJsonMock","generateYupSchema","saveCode","yupSchema2AntDesignForm","parseYupSchema","generateAntDesignForm","encoding","fs","__dirname","err","fileName","writeFile"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAO,IAAMA,MAAM,GAAG,SAATA,MAAS,CAAAC,CAAC;AAAA,SAAIA,CAAC,KAAK,IAAV;AAAA,CAAhB;AACA,IAAMC,WAAW,GAAG,SAAdA,WAAc,CAAAD,CAAC;AAAA,SAAI,OAAOA,CAAP,KAAa,WAAjB;AAAA,CAArB;AACA,IAAME,mBAAiB,GAAG,SAApBA,iBAAoB,CAAAF,CAAC;AAAA,SAAID,MAAM,CAACC,CAAD,CAAN,IAAaC,WAAW,CAACD,CAAD,CAA5B;AAAA,CAA3B;AAEA,IAAMG,eAAe,GAAG,SAAlBA,eAAkB,CAAAH,CAAC;AAAA,SAAII,KAAK,CAACC,OAAN,CAAcL,CAAd,KAAoBA,CAAC,CAACM,MAAF,GAAW,CAAnC;AAAA,CAAzB;AAGA,IAAMC,gBAAgB,GAAG,SAAnBA,gBAAmB,CAAAP,CAAC;AAAA,SAAI,OAAOA,CAAP,KAAa,QAAb,IAAyBA,CAAC,CAACM,MAAF,GAAW,CAAxC;AAAA,CAA1B;AAQA,IAAME,UAAU,GAAG,SAAbA,UAAa,CAAAR,CAAC;AAAA,SAAI,OAAOA,CAAP,KAAa,UAAjB;AAAA,CAApB;;;;ACfA,IAAMS,eAAe,GAAG,QAAxB;AACA,IAAMC,eAAe,GAAG,QAAxB;AACA,IAAMC,aAAa,GAAG,MAAtB;AACA,IAAMC,aAAa,GAAG,MAAtB;AACA,IAAMC,cAAc,GAAG,OAAvB;AACA,IAAMC,cAAc,GAAG,OAAvB;AACA,IAAMC,oBAAoB,GAAG,UAA7B;AACA,IAAMC,iBAAiB,GAAG,OAA1B;AAEP;;;;AAGO,IAAMC,aAAa,GAAG,CAC3BH,cAD2B,EAE3BL,eAF2B,EAG3BC,eAH2B,EAI3BE,aAJ2B,EAK3BC,cAL2B,EAM3BF,aAN2B,CAAtB;AASA,IAAMO,gBAAgB,+DAC1BJ,cAD0B,EACT,UAACK,KAAD;AAAA,SAAWA,KAAX;AAAA,CADS,sCAE1BV,eAF0B,EAER,UAACU,KAAD;AAAA,SAAWC,MAAM,CAACD,KAAD,CAAjB;AAAA,CAFQ,sCAG1BT,eAH0B,EAGR,UAACS,KAAD;AAAA,SAAWE,MAAM,CAACF,KAAD,CAAjB;AAAA,CAHQ,sCAI1BP,aAJ0B,EAIV,UAACO,KAAD;AAAA,SAAW,IAAIG,IAAJ,CAASH,KAAT,CAAX;AAAA,CAJU,sCAK1BR,aAL0B,EAKV,UAACQ,KAAD,EAAW;AAC1B,MAAIA,KAAK,KAAK,MAAd,EAAsB,OAAO,IAAP;AACtB,MAAIA,KAAK,KAAK,OAAd,EAAuB,OAAO,KAAP;AACxB,CAR0B,qBAAtB;;ACVP;;;;IAGaI,mBAAb,GACE,+BAAc;AAAA;;AACZ,OAAKC,UAAL,GAAkB,EAAlB;AACD,CAHH;AAMA;;;;IAGaC,0BAAb,GACE,oCAAYC,GAAZ,EAAiBP,KAAjB,EAA0C;AAAA,MAAlBQ,WAAkB,uEAAJ,EAAI;;AAAA;;AACxC,OAAKD,GAAL,GAAWA,GAAX;AACA,OAAKP,KAAL,GAAaA,KAAb;AACA,OAAKS,IAAL,GAAYd,cAAZ;AACA,OAAKa,WAAL,GAAmBA,WAAnB;AACD,CANH;AASA;;;;;;;;;;IASaE,0BAAb;AACE,sCAAYC,MAAZ,EAAoBC,IAApB,EAA0B;AAAA;;AACxB,SAAKD,MAAL,GAAcA,MAAd;AACA,SAAKC,IAAL,GAAYA,IAAZ;AACA,SAAKC,oBAAL,GAA4Bf,aAAa,CAACgB,QAAd,CAAuB,KAAKC,MAA5B,CAA5B;AACD;;AALH;AAAA;AAAA,oCAckB;AAAA;;AACd,UAAI3B,gBAAgB,CAAC,KAAKwB,IAAN,CAApB,EAAiC;AAC/B,YAAMI,KAAK,GAAG,KAAKJ,IAAL,CACXK,KADW,CACL,GADK,EAEXC,GAFW,CAEP,UAACC,CAAD;AAAA,iBAAOA,CAAC,CAACC,IAAF,EAAP;AAAA,SAFO,EAGXC,MAHW,CAGJjC,gBAHI,CAAd;AAKA,eAAO4B,KAAK,CAACE,GAAN,CAAU,UAACI,IAAD,EAAU;AACzB,cAAMb,IAAI,GAAGc,cAAc,CAACD,IAAD,CAA3B;AACA,cAAME,GAAG,GAAGF,IAAZ;AACA,cAAMG,IAAI,GAAG1B,gBAAgB,CAACU,IAAD,CAA7B;AACA,cAAMT,KAAK,GAAGX,UAAU,CAACoC,IAAD,CAAV,GAAmBA,IAAI,CAACH,IAAD,CAAvB,GAAgCA,IAA9C;AAEA,WAACjC,UAAU,CAACoC,IAAD,CAAX,IAAqBC,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAyB,KAAI,CAACZ,MAA9B,EAAsCN,IAAtC,EAA4Ce,GAA5C,CAArB;AAEA,iBAAO,IAAII,mCAAJ,CAAwCnB,IAAxC,EAA8Ce,GAA9C,EAAmDxB,KAAnD,CAAP;AACD,SATM,CAAP;AAUD;;AAED,aAAO,EAAP;AACD;AAlCH;AAAA;AAAA,wBAOe;AACX,aAAO,KAAKW,MAAL,CAAY,CAAZ,CAAP;AACD;AATH;AAAA;AAAA,wBAUe;AACX,aAAO,KAAKA,MAAL,CAAYkB,SAAZ,CAAsB,CAAtB,CAAP;AACD;AAZH;;AAAA;AAAA;IAqCaD,mCAAb;AACE,+CAAYnB,IAAZ,EAAkBe,GAAlB,EAAuBxB,KAAvB,EAA8B;AAAA;;AAC5B,SAAKS,IAAL,GAAYA,IAAZ;AACA,SAAKe,GAAL,GAAWA,GAAX;AACA,SAAKxB,KAAL,GAAaA,KAAb;AACD;;AALH;AAAA;AAAA,8BAOY;AACR,aAAO,KAAKA,KAAZ;AACD;AATH;AAAA;AAAA,+BAWa;AACT,aAAO,KAAKwB,GAAZ;AACD;AAbH;;AAAA;AAAA;;AAgBA,SAASD,cAAT,CAAwBvB,KAAxB,EAA+B;AAC7B,MAAM8B,CAAC,GAAG,iBAAV;AACA,MAAMC,CAAC,GAAG,UAAV;AACA,MAAMC,CAAC,GAAG,0BAAV;AACA,MAAMC,CAAC,GAAG,iPAAV;;AAEA,MAAIH,CAAC,CAACI,IAAF,CAAOlC,KAAP,CAAJ,EAAmB;AACjB,WAAOR,aAAP;AACD;;AACD,MAAIyC,CAAC,CAACC,IAAF,CAAOlC,KAAP,CAAJ,EAAmB;AACjB,WAAOP,aAAP;AACD;;AACD,MAAIsC,CAAC,CAACG,IAAF,CAAOlC,KAAP,CAAJ,EAAmB;AACjB,WAAOT,eAAP;AACD;;AACD,MAAIyC,CAAC,CAACE,IAAF,CAAOlC,KAAP,CAAJ,EAAmB;AACjB,WAAOT,eAAP;AACD;;AAED,SAAOD,eAAP;AACD;;AClHD;;;;AAcA;;;;AAGA;;;;;AAIe,uBAAU6C,QAAV,EAAoB;AACjCC,EAAAA,cAAc,CAACD,QAAD,CAAd;AACAE,EAAAA,eAAe,CAACF,QAAD,CAAf,CAFiC;AAIlC;AAED;;;;;AAIA,SAASC,cAAT,CAAwBD,QAAxB,EAAkC;AAChC,MAAMG,kBAAkB,GAAGH,QAAQ,CAAC3B,WAAT,CAAqB+B,IAArB,CACzB,UAACC,CAAD;AAAA,WAAOA,CAAC,CAAC3B,oBAAT;AAAA,GADyB,CAA3B;;AAIA,MAAI,CAAC9B,mBAAiB,CAACuD,kBAAD,CAAtB,EAA4C;AAC1CH,IAAAA,QAAQ,CAAC1B,IAAT,GAAgB6B,kBAAkB,CAACvB,MAAnC;AACA;AACD;;AAED,MAAMN,IAAI,GAAGgC,cAAc,CAACN,QAAQ,CAACnC,KAAV,CAA3B;;AACA,MAAI,CAACjB,mBAAiB,CAAC0B,IAAD,CAAtB,EAA8B;AAC5B0B,IAAAA,QAAQ,CAAC1B,IAAT,GAAgBA,IAAhB;AACA0B,IAAAA,QAAQ,CAAC3B,WAAT,CAAqBkC,IAArB,CAA0B,IAAIhC,0BAAJ,CAA+BD,IAA/B,EAAqC,IAArC,CAA1B;AACA;AACD;AACF;AAED;;;;;AAGA,SAAS4B,eAAT,CAAyBF,QAAzB,EAAmC;AACjCA,EAAAA,QAAQ,CAAC3B,WAAT,CAAqBmC,OAArB;AAEA,MAAMC,KAAK,GAAGT,QAAQ,CAAC3B,WAAT,CAAqBqC,SAArB,CAA+B,UAACL,CAAD;AAAA,WAAOA,CAAC,CAAC3B,oBAAT;AAAA,GAA/B,CAAd;;AACA,MAAI+B,KAAK,GAAG,CAAC,CAAb,EAAgB;AACd,QAAME,UAAU,GAAGX,QAAQ,CAAC3B,WAAT,CAAqBoC,KAArB,CAAnB;AACAT,IAAAA,QAAQ,CAAC3B,WAAT,CAAqBuC,MAArB,CAA4BH,KAA5B,EAAmC,CAAnC;AACAT,IAAAA,QAAQ,CAAC3B,WAAT,CAAqBkC,IAArB,CAA0BI,UAA1B;AACD;AACF;;AAED,SAASL,cAAT,CAAwBzC,KAAxB,EAA+B;AAC7B,MAAM8B,CAAC,GAAG,iBAAV;AACA,MAAMC,CAAC,GAAG,UAAV;AACA,MAAMC,CAAC,GAAG,0BAAV;AACA,MAAMC,CAAC,GAAG,iPAAV;;AAEA,MAAIH,CAAC,CAACI,IAAF,CAAOlC,KAAP,CAAJ,EAAmB;AACjB,WAAO,MAAMR,aAAb;AACD;;AACD,MAAIyC,CAAC,CAACC,IAAF,CAAOlC,KAAP,CAAJ,EAAmB;AACjB,WAAO,MAAMP,aAAb;AACD;;AACD,MAAIsC,CAAC,CAACG,IAAF,CAAOlC,KAAP,CAAJ,EAAmB;AACjB,WAAO,MAAMT,eAAb;AACD;;AACD,MAAIyC,CAAC,CAACE,IAAF,CAAOlC,KAAP,CAAJ,EAAmB;AACjB,WAAO,MAAMT,eAAb;AACD;;AACD,SAAO,MAAMD,eAAb;AACD;;ACnED;;;;;;AAKe,wBAAU0D,IAAV,EAAgB;AAC7B,MAAMC,GAAG,GAAGC,YAAK,CAACF,IAAD,EAAO;AAAEG,IAAAA,UAAU,EAAE;AAAd,GAAP,CAAjB;AACA,MAAMC,WAAW,GAAGC,mBAAmB,CAACJ,GAAD,CAAvC;AAEA,SAAOG,WAAP;AACD;AAEM,SAASC,mBAAT,CAA6BJ,GAA7B,EAAkC;AACvC,MAAMG,WAAW,GAAG,IAAIhD,mBAAJ,EAApB;AAEA,MAAMkD,eAAe,GAAG;AACtBC,IAAAA,cADsB,0BACPC,IADO,EACD;AACnB,UAAMrB,QAAQ,GAAGsB,oBAAoB,CAACD,IAAI,CAACE,IAAN,CAArC;AACAC,MAAAA,YAAY,CAACxB,QAAD,CAAZ;AACAiB,MAAAA,WAAW,CAAC/C,UAAZ,CAAuBqC,IAAvB,CAA4BP,QAA5B;AACD;AALqB,GAAxB;AAQAyB,EAAAA,QAAQ,CAACX,GAAD,EAAM;AACZY,IAAAA,wBADY,oCACaL,IADb,EACmB;AAC7BA,MAAAA,IAAI,CAACI,QAAL,CAAc;AACZE,QAAAA,gBADY,4BACKN,IADL,EACW;AACrBA,UAAAA,IAAI,CAACI,QAAL,CAAcN,eAAd;AACD;AAHW,OAAd;AAKD;AAPW,GAAN,CAAR;AAUA,SAAOF,WAAP;AACD;AAED;;;;;AAIO,SAASK,oBAAT,CAA8BM,OAA9B,EAAuC;AAAA,MACpCxD,GADoC,GACJwD,OADI,CACpCxD,GADoC;AAAA,MAC/BP,KAD+B,GACJ+D,OADI,CAC/B/D,KAD+B;AAAA,MACxBgE,eADwB,GACJD,OADI,CACxBC,eADwB;AAE5C,MAAMC,UAAU,GAAGD,eAAe,CAC/B9C,GADgB,CACZ,UAACgD,OAAD;AAAA,WAAaC,cAAc,CAAC5D,GAAG,CAAC6D,IAAL,EAAWF,OAAX,CAA3B;AAAA,GADY,EAEhB7C,MAFgB,CAET,UAACgD,CAAD;AAAA,WAAO,CAACtF,mBAAiB,CAACsF,CAAD,CAAzB;AAAA,GAFS,CAAnB;AAIA,SAAO,IAAI/D,0BAAJ,CAA+BC,GAAG,CAAC6D,IAAnC,EAAyCpE,KAAK,CAACA,KAA/C,EAAsDiE,UAAtD,CAAP;AACD;AACD;;;;;AAIO,SAASE,cAAT,CAAwB5D,GAAxB,EAA6B+D,cAA7B,EAA6C;AAClD,MAAIA,cAAc,CAACtE,KAAf,CAAqBoB,IAArB,OAAgC,EAApC,EAAwC;AACtC,WAAO,IAAP;AACD;;AAED,MAAMmD,CAAC,GAAG,gBAAV;AACA,MAAMC,OAAO,GAAGF,cAAc,CAACtE,KAAf,CAAqByE,KAArB,CAA2BF,CAA3B,CAAhB;;AAEA,MAAIvF,eAAe,CAACwF,OAAD,CAAnB,EAA8B;AAAA,kCACXA,OADW;AAAA,QACnB1C,CADmB;AAAA,QAChB4C,CADgB;;AAE5B,QAAI/D,MAAJ,EAAYC,IAAZ;;AACA,QAAIxB,gBAAgB,CAAC0C,CAAD,CAApB,EAAyB;AACvBnB,MAAAA,MAAM,GAAGmB,CAAC,CAACV,IAAF,EAAT;AACAR,MAAAA,IAAI,GAAG8D,CAAC,CAACtD,IAAF,EAAP;AACD,KAHD,MAGO,IAAIU,CAAC,KAAK,EAAN,IAAY4C,CAAC,CAAC5D,QAAF,CAAW,GAAX,CAAhB,EAAiC;AACtCH,MAAAA,MAAM,GAAG+D,CAAC,CAACtD,IAAF,EAAT;AACAR,MAAAA,IAAI,GAAG,IAAP;AACD,KAHM,MAGA;AACLD,MAAAA,MAAM,GAAG,QAAT;AACAC,MAAAA,IAAI,GAAG8D,CAAC,CAACtD,IAAF,EAAP;AACD;;AAED,WAAO,IAAIV,0BAAJ,CAA+BC,MAA/B,EAAuCC,IAAvC,CAAP;AACD,GAfD,MAeO;AACL,WAAO,IAAIF,0BAAJ,CAA+B,QAA/B,EAAyCH,GAAzC,CAAP;AACD;AACF;;ICjFYoE,oBAAb,GACE,gCAAc;AAAA;;AACZ,OAAKC,KAAL,GAAa,EAAb;AACD,CAHH;IAMaC,uBAAb;AACE,mCAAYT,IAAZ,EAAmC;AAAA,QAAjBU,UAAiB,uEAAJ,EAAI;;AAAA;;AACjC,SAAKV,IAAL,GAAYA,IAAZ;AACA,SAAKU,UAAL,GAAkBA,UAAlB;AACA,SAAKC,MAAL,GAAc,IAAd;AACA,SAAKC,SAAL,GAAiB,IAAjB;AACA,SAAKC,WAAL,GAAmB,IAAnB;AACD;;AAPH;AAAA;AAAA,iCAsCe;AACX,UAAI,CAAClG,mBAAiB,CAAC,KAAKkG,WAAN,CAAtB,EAA0C;AACxC,eAAO,KAAKA,WAAZ;AACD;;AAED,aAAO,KAAKC,YAAL,CAAkBtF,oBAAlB,CAAP;AACD;AA5CH;AAAA;AAAA,iCA8CewE,IA9Cf,EA8CqB;AACjB,aAAO,KAAKU,UAAL,CAAgBK,IAAhB,CAAqB;AAAA,YAAG5E,GAAH,QAAGA,GAAH;AAAA,eAAaA,GAAG,KAAK6D,IAArB;AAAA,OAArB,CAAP;AACD;AAhDH;AAAA;AAAA,iCAiDe7D,GAjDf,EAiDoB;AAChB,aAAO,KAAKuE,UAAL,CAAgBvC,IAAhB,CAAqB,UAAC6C,IAAD;AAAA,eAAUA,IAAI,CAAC7E,GAAL,KAAaA,GAAvB;AAAA,OAArB,CAAP;AACD;AAnDH;AAAA;AAAA,wBASc;AACV,UAAI,CAACxB,mBAAiB,CAAC,KAAKgG,MAAN,CAAtB,EAAqC;AACnC,eAAO,KAAKA,MAAZ;AACD;;AAED,UAAMM,KAAK,GAAG,KAAKP,UAAL,CAAgBvC,IAAhB,CACZ,UAAC6C,IAAD;AAAA,eAAUA,IAAI,CAAC7E,GAAL,KAAaV,iBAAvB;AAAA,OADY,CAAd;;AAGA,UAAI,CAACd,mBAAiB,CAACsG,KAAD,CAAtB,EAA+B;AAC7B,aAAKN,MAAL,GAAcM,KAAK,CAACC,MAAN,CAAa,CAAb,CAAd;AACA,eAAO,KAAKP,MAAZ;AACD;AACF;AArBH;AAAA;AAAA,wBAuBiB;AACb,UAAI,CAAChG,mBAAiB,CAAC,KAAKiG,SAAN,CAAtB,EAAwC;AACtC,eAAO,KAAKA,SAAZ;AACD;;AAED,UAAMK,KAAK,GAAG,KAAKP,UAAL,CAAgBvC,IAAhB,CACZ,UAAC6C,IAAD;AAAA,eAAUA,IAAI,CAACG,mBAAL,KAA6B,IAAvC;AAAA,OADY,CAAd;;AAIA,UAAI,CAACxG,mBAAiB,CAACsG,KAAD,CAAtB,EAA+B;AAC7B,aAAKL,SAAL,GAAiBK,KAAK,CAAC9E,GAAvB;AACA,eAAO8E,KAAK,CAAC9E,GAAb;AACD;AACF;AApCH;;AAAA;AAAA;IAsDaiF,gCAAb,GACE,0CAAYjF,GAAZ,EAA8B;AAAA,MAAb+E,MAAa,uEAAJ,EAAI;;AAAA;;AAC5B,OAAK/E,GAAL,GAAWA,GAAX;AACA,OAAK+E,MAAL,GAAcA,MAAd;AACA,OAAKC,mBAAL,GAA2BzF,aAAa,CAACgB,QAAd,CAAuBP,GAAvB,CAA3B;AACD,CALH;;AC/DA;;;;;;AAKe,yBAAUyC,IAAV,EAAgB;AAC7B,MAAMC,GAAG,GAAGC,YAAK,CAACF,IAAD,EAAO;AAAEG,IAAAA,UAAU,EAAE;AAAd,GAAP,CAAjB;AACA,MAAMC,WAAW,GAAGqC,oBAAoB,CAACxC,GAAD,CAAxC;AAEA,SAAOG,WAAP;AACD;AAEM,SAASqC,oBAAT,CAA8BxC,GAA9B,EAAmC;AACxC,MAAIyC,2BAA2B,GAAG,KAAlC;AACA,MAAMC,IAAI,GAAG,IAAIhB,oBAAJ,EAAb;AAEAf,EAAAA,QAAQ,CAACX,GAAD,EAAM;AACZY,IAAAA,wBADY,oCACaL,IADb,EACmB;AAAA,UACRoC,UADQ,GACOpC,IAAI,CAACE,IADZ,CACrBmC,WADqB;;AAE7B,UACE5D,kBAAA,CAAmB2D,UAAnB,KACA3D,cAAA,CAAe2D,UAAU,CAACE,MAA1B,CADA,IAEAF,UAAU,CAACE,MAAX,CAAkB1B,IAAlB,KAA2B,QAH7B,EAIE;AACAsB,QAAAA,2BAA2B,GAAG,IAA9B;;AADA,mDAGuBE,UAAU,CAACG,SAAX,CAAqB,CAArB,EAAwB1F,UAH/C;AAAA;;AAAA;AAGA,8DAA2D;AAAA,gBAAhD8B,QAAgD;AAAA,gBACjD5B,GADiD,GAClC4B,QADkC,CACjD5B,GADiD;AAAA,gBAC5CP,KAD4C,GAClCmC,QADkC,CAC5CnC,KAD4C;AAEzD,gBAAM8E,UAAU,GAAG,EAAnB;AACAkB,YAAAA,kBAAkB,CAAChG,KAAD,EAAQ8E,UAAR,CAAlB;AACA,gBAAMmB,IAAI,GAAG,IAAIpB,uBAAJ,CAA4BtE,GAAG,CAAC6D,IAAhC,CAAb;AACA6B,YAAAA,IAAI,CAACnB,UAAL,GAAkBA,UAAlB;AAEAa,YAAAA,IAAI,CAACf,KAAL,CAAWlC,IAAX,CAAgBuD,IAAhB;AACD;AAXD;AAAA;AAAA;AAAA;AAAA;AAYD;AACF;AApBW,GAAN,CAAR;;AAuBA,MAAIP,2BAAJ,EAAiC;AAC/BhE,IAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;AAEA,WAAOgE,IAAP;AACD,GAJD,MAIO;AACLjE,IAAAA,OAAO,CAACwE,KAAR,CACE,6DADF;AAGD;AACF;;AAED,SAASF,kBAAT,CAA4BhG,KAA5B,EAAmC8E,UAAnC,EAA+C;AAC7C,MAAI7C,kBAAA,CAAmBjC,KAAnB,CAAJ,EAA+B;AAAA,QACrB8F,MADqB,GACV9F,KADU,CACrB8F,MADqB;AAG7BhB,IAAAA,UAAU,CAACpC,IAAX,CACE,IAAI8C,gCAAJ,CACEvD,oBAAA,CAAqB6D,MAArB,IAA+BA,MAAM,CAAC3D,QAAP,CAAgBiC,IAA/C,GAAsD0B,MAAM,CAAC1B,IAD/D,EAEE+B,UAAU,CAACnG,KAAK,CAAC+F,SAAP,CAFZ,CADF;;AAOA,QAAI9D,oBAAA,CAAqB6D,MAArB,CAAJ,EAAkC;AAChCE,MAAAA,kBAAkB,CAACF,MAAM,CAACM,MAAR,EAAgBtB,UAAhB,CAAlB;AACD;AACF;AACF;;AAED,SAASqB,UAAT,CAAoBE,UAApB,EAAgC;AAC9B,SAAOA,UAAU,CAACnF,GAAX,CAAe,UAACoF,GAAD,EAAS;AAC7B,QAAIrE,mBAAA,CAAoBqE,GAApB,CAAJ,EAA8B;AAC5B,aAAOA,GAAG,CAACC,QAAJ,CAAarF,GAAb,CAAiB,UAACsF,CAAD;AAAA,eAAOA,CAAC,CAACxG,KAAT;AAAA,OAAjB,CAAP;AACD,KAFD,MAEO;AACL,aAAOsG,GAAG,CAACtG,KAAX;AACD;AACF,GANM,CAAP;AAOD;;ACxED,IAAMyG,aAAa,6JAAnB;AAQA;;;;;;AAKe,4BAAUrD,WAAV,EAAuB;AACpC,MAAMH,GAAG,GAAGC,YAAK,CAACuD,aAAD,EAAgB;AAAEtD,IAAAA,UAAU,EAAE;AAAd,GAAhB,CAAjB;AACA,MAAMuD,iBAAiB,GAAGzD,GAAG,CAAC0D,OAAJ,CAAY/F,IAAZ,CAAiB,CAAjB,EAAoBiF,WAA9C;AAEA,MAAMxF,UAAU,GAAG,EAAnB;;AAJoC,6CAKb+C,WAAW,CAAC/C,UALC;AAAA;;AAAA;AAKpC,wDAA+C;AAAA,UAApC8B,QAAoC;AAC7C,UAAMyC,KAAK,GAAGgC,QAAQ,CAACzE,QAAD,CAAtB;AACA9B,MAAAA,UAAU,CAACqC,IAAX,CAAgBT,gBAAA,CAAiBA,YAAA,CAAaE,QAAQ,CAAC5B,GAAtB,CAAjB,EAA6CqE,KAA7C,CAAhB;AACD;AARmC;AAAA;AAAA;AAAA;AAAA;;AAUpC8B,EAAAA,iBAAiB,CAACX,SAAlB,CAA4BrD,IAA5B,CAAiCT,kBAAA,CAAmB5B,UAAnB,CAAjC;AAEA,MAAMwG,MAAM,GAAGC,QAAQ,CAAC7D,GAAD,EAAM,EAAN,EAAUwD,aAAV,CAAvB;AACA,MAAMzD,IAAI,GAAG+D,kBAAkB,CAACF,MAAM,CAACG,IAAR,CAA/B;AAEA,SAAOhE,IAAP;AACD;;AAED,SAAS4D,QAAT,CAAkBzE,QAAlB,EAA4B;AAC1B,MAAInD,eAAe,CAACmD,QAAQ,CAAC3B,WAAV,CAAnB,EAA2C;AACzC,WAAOyG,oBAAoB,CAAC9E,QAAQ,CAAC3B,WAAV,EAAuB,CAAvB,CAA3B;AACD;AACF;;AAED,SAASyG,oBAAT,CAA8BzG,WAA9B,EAA2CoC,KAA3C,EAAkD;AAChD,MAAIpC,WAAW,CAACrB,MAAZ,KAAuB,CAAvB,IAA4ByD,KAAK,KAAKpC,WAAW,CAACrB,MAAZ,GAAqB,CAA/D,EAAkE;AAChE,QAAM+H,IAAG,GAAG1G,WAAW,CAACoC,KAAD,CAAvB;AAEA,WAAOX,gBAAA,CAAiBA,YAAA,CAAaiF,IAAG,CAACnG,MAAjB,CAAjB,EAA2CoG,iBAAiB,CAACD,IAAD,CAA5D,CAAP;AACD;;AAED,MAAMA,GAAG,GAAG1G,WAAW,CAACoC,KAAD,CAAvB;AACA,SAAOX,gBAAA,CACLA,kBAAA,CACEgF,oBAAoB,CAACzG,WAAD,EAAcoC,KAAK,GAAG,CAAtB,CADtB,EAEEX,YAAA,CAAaiF,GAAG,CAACnG,MAAjB,CAFF,CADK,EAKLoG,iBAAiB,CAAC3G,WAAW,CAACoC,KAAD,CAAZ,CALZ,CAAP;AAOD;AACD;;;;;AAGA,SAASuE,iBAAT,CAA2BrE,UAA3B,EAAuC;AACrC,MAAMsE,MAAM,GAAGtE,UAAU,CAACuE,aAAX,EAAf;AACA,SAAOD,MAAM,CAAClG,GAAP,CAAW,UAACoG,CAAD,EAAO;AAAA,QACf7G,IADe,GACM6G,CADN,CACf7G,IADe;AAAA,QACTT,KADS,GACMsH,CADN,CACTtH,KADS;AAAA,QACFwB,GADE,GACM8F,CADN,CACF9F,GADE;;AAEvB,YAAQf,IAAR;AACE,WAAKnB,eAAL;AACE,eAAO2C,eAAA,CAAgBjC,KAAhB,CAAP;;AACF,WAAKT,eAAL;AACE,eAAO0C,gBAAA,CAAiBjC,KAAjB,CAAP;;AACF,WAAKR,aAAL;AACE,eAAOyC,gBAAA,CAAiBjC,KAAjB,CAAP;;AACF,WAAKP,aAAL;AACE,eAAOwC,eAAA,CAAgBA,YAAA,CAAa,MAAb,CAAhB,EAAsC,CAACA,eAAA,CAAgBT,GAAhB,CAAD,CAAtC,CAAP;;AACF;AACE,eAAOS,eAAA,CAAgBT,GAAhB,CAAP;AAVJ;AAYD,GAdM,CAAP;AAeD;AAED;;;;;;AAIA,SAASuF,kBAAT,CAA4BQ,WAA5B,EAAyC;AACvC,MAAMhD,CAAC,GAAG,kBAAV;AACA,MAAMiD,IAAI,GAAGD,WAAW,CAACE,OAAZ,CAAoBlD,CAApB,EAAuB,UAAUE,KAAV,EAAiBiD,GAAjB,EAAsB;AACxD,WAAOzH,MAAM,CAAC0H,YAAP,CAAoBC,QAAQ,CAACF,GAAD,EAAM,EAAN,CAA5B,CAAP;AACD,GAFY,CAAb;AAGA,SAAOG,kBAAkB,CAACL,IAAD,CAAzB;AACD;;ACrFD,IAAMf,eAAa,ixCAAnB;AAuCA,IAAMqB,OAAO,GAAG7F,SAAA,CAAU,IAAV,CAAhB;AAEe,gCAAUmB,WAAV,EAAuB;AACpC,MAAMH,GAAG,GAAGC,YAAK,CAACuD,eAAD,EAAgB;AAAEtD,IAAAA,UAAU,EAAE,QAAd;AAAwB4E,IAAAA,OAAO,EAAE,CAAC,KAAD;AAAjC,GAAhB,CAAjB;AACA,MAAMC,aAAa,GAAG/E,GAAG,CAAC0D,OAAJ,CAAY/F,IAAZ,CAAiB2B,IAAjB,CAAsBN,4BAAtB,CAAtB;AACA,MAAMgG,eAAe,GAAGD,aAAa,CAACnC,WAAd,CAA0BjF,IAA1B,CAA+BA,IAA/B,CAAoC2B,IAApC,CACtBN,mBADsB,CAAxB;AAGA,MAAMiG,UAAU,GAAGD,eAAe,CAACE,QAAnC;AAEAD,EAAAA,UAAU,CAACE,QAAX,CAAoB1F,IAApB,CAAyBoF,OAAzB;AACA,MAAMO,MAAM,GAAGpG,YAAA,CACbA,mBAAA,CAAoBA,eAAA,CAAgB,MAAhB,CAApB,EAA6C,EAA7C,CADa,EAEbA,mBAAA,CAAoBA,eAAA,CAAgB,MAAhB,CAApB,CAFa,EAGb,CAAC6F,OAAD,CAHa,CAAf;;AAToC,6CAejB1E,WAAW,CAACwB,KAfK;AAAA;;AAAA;AAepC,wDAAsC;AAAA,UAA3BqB,IAA2B;AACpCoC,MAAAA,MAAM,CAACD,QAAP,CAAgB1F,IAAhB,CAAqB4F,SAAS,CAACrC,IAAD,CAA9B;AACAoC,MAAAA,MAAM,CAACD,QAAP,CAAgB1F,IAAhB,CAAqBoF,OAArB;AACD;AAlBmC;AAAA;AAAA;AAAA;AAAA;;AAmBpCI,EAAAA,UAAU,CAACE,QAAX,CAAoB1F,IAApB,CAAyB2F,MAAzB;AACAH,EAAAA,UAAU,CAACE,QAAX,CAAoB1F,IAApB,CAAyBoF,OAAzB;AACA,MAAMjB,MAAM,GAAGC,QAAQ,CAAC7D,GAAD,EAAM,EAAN,EAAUwD,eAAV,CAAvB;AAEA,SAAOI,MAAM,CAACG,IAAd;AACD;;AAED,SAASsB,SAAT,CAAmBC,cAAnB,EAAmC;AACjC,MAAMC,QAAQ,GAAGD,cAAc,CAACC,QAAhC;;AAEA,MAAI,CAAC1I,aAAa,CAACgB,QAAd,CAAuB0H,QAAvB,CAAL,EAAuC;AACrC,WAAOvG,oBAAA,EAAP;AACD;;AAED,MAAIuG,QAAQ,KAAK/I,aAAjB,EAAgC;AAC9B,WAAOgJ,cAAc,CAACF,cAAD,CAArB;AACD,GAFD,MAEO;AACL,WAAOG,aAAa,CAACH,cAAD,CAApB;AACD;AACF;;AAED,SAASI,mBAAT,GAA+B;AAC7B,SAAO1G,YAAA,CACLA,mBAAA,CAAoBA,eAAA,CAAgB,UAAhB,CAApB,EAAiD,EAAjD,EAAqD,IAArD,CADK,EAEL,IAFK,EAGL,EAHK,EAIL,IAJK,CAAP;AAMD;;AAED,SAAS2G,wBAAT,CAAkCxE,IAAlC,EAAwC;AACtC,SAAOnC,cAAA,CACLA,eAAA,CAAgB,WAAhB,CADK,EAELA,wBAAA,CACEA,gBAAA,CAAiBA,YAAA,CAAa,iBAAb,CAAjB,EAAkD,CAChDA,eAAA,CAAgBmC,IAAhB,CADgD,CAAlD,CADF,CAFK,CAAP;AAQD;;AAED,SAASqE,cAAT,CAAwBF,cAAxB,EAAwC;AAAA,MAC9BnE,IAD8B,GACrBmE,cADqB,CAC9BnE,IAD8B;AAEtC,MAAMyE,MAAM,GAAG5G,eAAA,CAAgB,YAAhB,CAAf;AACA,MAAMX,IAAI,GAAGW,eAAA,CAAgB,WAAhB,CAAb;AAEA,SAAOA,YAAA,CACLA,mBAAA,CAAoB4G,MAApB,EAA4B,CAC1B5G,cAAA,CAAeA,eAAA,CAAgB,MAAhB,CAAf,EAAwCA,eAAA,CAAgB,MAAhB,CAAxC,CAD0B,EAE1BA,cAAA,CACEA,eAAA,CAAgB,UAAhB,CADF,EAEEA,wBAAA,CACEA,gBAAA,CAAiBA,YAAA,CAAa,oBAAb,CAAjB,EAAqD,CACnDA,eAAA,CAAgBmC,IAAhB,CADmD,CAArD,CADF,CAFF,CAF0B,CAA5B,CADK,EAYLnC,mBAAA,CAAoB4G,MAApB,CAZK,EAaL,CACEf,OADF,EAEE7F,YAAA,CACEA,mBAAA,CAAoBX,IAApB,EAA0B,CACxBW,cAAA,CACEA,eAAA,CAAgB,OAAhB,CADF,EAEEA,eAAA,CAAgB,YAAhB,CAFF,CADwB,EAKxB2G,wBAAwB,CAACxE,IAAD,CALA,CAA1B,CADF,EAQEnC,mBAAA,CAAoBX,IAApB,CARF,EASEwH,oBAAoB,CAACP,cAAD,CATtB,CAFF,EAaET,OAbF,CAbK,CAAP;AA6BD;;AAED,SAASY,aAAT,CAAuBH,cAAvB,EAAuC;AAAA,MAC7BnE,IAD6B,GACpBmE,cADoB,CAC7BnE,IAD6B;AAErC,MAAM2E,SAAS,GAAG9G,eAAA,CAAgB,WAAhB,CAAlB;AACA,SAAOA,YAAA,CACLA,mBAAA,CAAoB8G,SAApB,EAA+B,CAC7BH,wBAAwB,CAACxE,IAAD,CADK,EAE7BnC,cAAA,CACEA,eAAA,CAAgB,UAAhB,CADF,EAEEA,wBAAA,CACEA,gBAAA,CAAiBA,YAAA,CAAa,mBAAb,CAAjB,EAAoD,CAClDA,eAAA,CAAgBmC,IAAhB,CADkD,CAApD,CADF,CAFF,CAF6B,EAU7BnC,cAAA,CACEA,eAAA,CAAgB,QAAhB,CADF,EAEEA,wBAAA,CACEA,gBAAA,CAAiBA,YAAA,CAAa,kBAAb,CAAjB,EAAmD,CACjDA,eAAA,CAAgBmC,IAAhB,CADiD,CAAnD,CADF,CAFF,CAV6B,CAA/B,CADK,EAoBLnC,mBAAA,CAAoB8G,SAApB,CApBK,EAqBLD,oBAAoB,CAACP,cAAD,CArBf,CAAP;AAuBD;;AAED,SAASO,oBAAT,CAA8BP,cAA9B,EAA8C;AAAA,MACpCS,KADoC,GACdT,cADc,CACpCS,KADoC;AAAA,MAC7BC,UAD6B,GACdV,cADc,CAC7BU,UAD6B;AAG5C,MAAMb,QAAQ,GAAG,EAAjB;;AACA,MAAIhJ,gBAAgB,CAAC4J,KAAD,CAApB,EAA6B;AAC3BZ,IAAAA,QAAQ,CAAC1F,IAAT,CAAcT,SAAA,CAAU+G,KAAV,CAAd;AACD;;AACD,MAAIC,UAAU,KAAK,IAAnB,EAAyB;AACvBb,IAAAA,QAAQ,CAAC1F,IAAT,CAAciG,mBAAmB,EAAjC;AACD;;AACD,SAAOP,QAAP;AACD;;ACrLM,SAASc,kBAAT,CACLC,QADK,EAIL;AAAA,MAFAC,QAEA,uEAFW,KAEX;AAAA,MADAC,YACA,uEADe,WACf;AACA,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC9H,IAAAA,OAAO,CAAC+H,IAAR,CACE,+DADF;AAIA,WAAOC,QAAQ,CAACP,QAAD,CAAR,CAAmBQ,IAAnB,CAAwB,UAACC,OAAD,EAAa;AAC1C,UAAMxG,WAAW,GAAGyG,aAAa,CAACD,OAAD,CAAjC;AACA,UAAM5C,IAAI,GAAG8C,iBAAiB,CAAC1G,WAAD,CAA9B;AAEA1B,MAAAA,OAAO,CAACC,GAAR,CAAY,4BAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYqF,IAAZ;;AAEA,UAAIoC,QAAJ,EAAc;AACZ,eAAOW,QAAQ,CAAC/C,IAAD,EAAOqC,YAAP,CAAf;AACD,OAFD,MAEO;AACLE,QAAAA,OAAO;AACR;AACF,KAZM,CAAP;AAaD,GAlBM,CAAP;AAmBD;AAEM,SAASS,uBAAT,CACLb,QADK,EAIL;AAAA,MAFAC,QAEA,uEAFW,KAEX;AAAA,MADAC,YACA,uEADe,UACf;AACA,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAa;AAC9B7H,IAAAA,OAAO,CAAC+H,IAAR,CACE,8DADF;AAIA,WAAOC,QAAQ,CAACP,QAAD,CAAR,CAAmBQ,IAAnB,CAAwB,UAACC,OAAD,EAAa;AAC1C,UAAMxG,WAAW,GAAG6G,cAAc,CAACL,OAAD,CAAlC;AACA,UAAM5C,IAAI,GAAGkD,qBAAqB,CAAC9G,WAAD,CAAlC;AAEA1B,MAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYqF,IAAZ;;AAEA,UAAIoC,QAAJ,EAAc;AACZ,eAAOW,QAAQ,CAAC/C,IAAD,EAAOqC,YAAP,CAAf;AACD,OAFD,MAEO;AACLE,QAAAA,OAAO;AACR;AACF,KAZM,CAAP;AAaD,GAlBM,CAAP;AAmBD;;AAED,SAASG,QAAT,CAAkBP,QAAlB,EAA+C;AAAA,MAAnBgB,QAAmB,uEAAR,MAAQ;AAC7C,SAAO,IAAIb,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCY,IAAAA,EAAE,CAACV,QAAH,CAAYlG,IAAI,CAAC+F,OAAL,CAAac,SAAb,EAAwBlB,QAAxB,CAAZ,EAA+CgB,QAA/C,EAAyD,UACvDG,GADuD,EAEvDV,OAFuD,EAGvD;AACA,UAAIU,GAAJ,EAAS;AACP5I,QAAAA,OAAO,CAACwE,KAAR,CAAcoE,GAAd;AACAd,QAAAA,MAAM;AACP;;AACDD,MAAAA,OAAO,CAACK,OAAD,CAAP;AACD,KATD;AAUD,GAXM,CAAP;AAYD;;AAED,SAASG,QAAT,CAAkB/C,IAAlB,EAAwBuD,QAAxB,EAAqD;AAAA,MAAnBJ,QAAmB,uEAAR,MAAQ;AACnD,SAAO,IAAIb,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCY,IAAAA,EAAE,CAACI,SAAH,CAAahH,IAAI,CAAC+F,OAAL,CAAac,SAAb,EAAwBE,QAAxB,CAAb,EAAgDvD,IAAhD,EAAsDmD,QAAtD,EAAgE,UAC9DG,GAD8D,EAE9D;AACA,UAAI,CAACvL,iBAAiB,CAACuL,GAAD,CAAtB,EAA6B;AAC3B5I,QAAAA,OAAO,CAACwE,KAAR,CAAcoE,GAAd;AACAd,QAAAA,MAAM;AACP;;AAED9H,MAAAA,OAAO,CAACC,GAAR,CAAYwH,QAAQ,GAAG,aAAvB;AACAI,MAAAA,OAAO;AACR,KAVD;AAWD,GAZM,CAAP;AAaD;;;;;"}